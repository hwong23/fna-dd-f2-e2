<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Harry Wong, ing." />
  <meta name="author" content="Wilson Morales, ing." />
  <meta name="author" content="Flavio Hernandez, ing." />
  <meta name="author" content="Viviana M. Martinez, ing." />
  <meta name="dcterms.date" content="2023-07-31" />
  <meta name="keywords" content="SOA, madurez, gobierno, FNA" />
  <title>Etapa 2. Ejecución Gobierno. Incremento 1</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
    }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
  <!--
  Manubot generated metadata rendered from header-includes-template.html.
  Suggest improvements at https://github.com/manubot/manubot/blob/main/manubot/process/header-includes-template.html
  -->
  <meta name="dc.format" content="text/html" />
  <meta property="og:type" content="article" />
  <meta name="dc.title" content="Etapa 2. Ejecución Gobierno. Incremento 1" />
  <meta name="citation_title" content="Etapa 2. Ejecución Gobierno. Incremento 1" />
  <meta property="og:title" content="Etapa 2. Ejecución Gobierno. Incremento 1" />
  <meta property="twitter:title" content="Etapa 2. Ejecución Gobierno. Incremento 1" />
  <meta name="dc.date" content="2023-07-31" />
  <meta name="citation_publication_date" content="2023-07-31" />
  <meta property="article:published_time" content="2023-07-31" />
  <meta name="dc.modified" content="2023-07-31T10:30:46+00:00" />
  <meta property="article:modified_time" content="2023-07-31T10:30:46+00:00" />
  <meta name="dc.language" content="en-US" />
  <meta name="citation_language" content="en-US" />
  <meta name="dc.relation.ispartof" content="Manubot" />
  <meta name="dc.publisher" content="Manubot" />
  <meta name="citation_journal_title" content="Manubot" />
  <meta name="citation_technical_report_institution" content="Manubot" />
  <meta name="citation_author" content="Harry Wong, ing." />
  <meta name="citation_author_institution" content="Arquitecto SOA, Stefanini" />
  <meta name="citation_author" content="Wilson Morales, ing." />
  <meta name="citation_author_institution" content="Software, Aplicaciones" />
  <meta name="citation_author" content="Flavio Hernandez, ing." />
  <meta name="citation_author_institution" content="SOA, Arquitectura" />
  <meta name="citation_author" content="Viviana M. Martinez, ing." />
  <meta name="citation_author_institution" content="Analista, Proyectos" />
  <link rel="canonical" href="https://hwong23.github.io/fna-dd-f2-e2/" />
  <meta property="og:url" content="https://hwong23.github.io/fna-dd-f2-e2/" />
  <meta property="twitter:url" content="https://hwong23.github.io/fna-dd-f2-e2/" />
  <meta name="citation_fulltext_html_url" content="https://hwong23.github.io/fna-dd-f2-e2/" />
  <meta name="citation_pdf_url" content="https://hwong23.github.io/fna-dd-f2-e2/manuscript.pdf" />
  <link rel="alternate" type="application/pdf" href="https://hwong23.github.io/fna-dd-f2-e2/manuscript.pdf" />
  <link rel="alternate" type="text/html" href="https://hwong23.github.io/fna-dd-f2-e2/v/8f72adc093a4b90f363de89e03b42ebe89e286f8/" />
  <meta name="manubot_html_url_versioned" content="https://hwong23.github.io/fna-dd-f2-e2/v/8f72adc093a4b90f363de89e03b42ebe89e286f8/" />
  <meta name="manubot_pdf_url_versioned" content="https://hwong23.github.io/fna-dd-f2-e2/v/8f72adc093a4b90f363de89e03b42ebe89e286f8/manuscript.pdf" />
  <meta property="og:type" content="article" />
  <meta property="twitter:card" content="summary_large_image" />
  <link rel="icon" type="image/png" sizes="192x192" href="https://manubot.org/favicon-192x192.png" />
  <link rel="mask-icon" href="https://manubot.org/safari-pinned-tab.svg" color="#ad1457" />
  <meta name="theme-color" content="#ad1457" />
  <!-- end Manubot generated metadata -->
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Etapa 2. Ejecución Gobierno. Incremento 1</h1>
</header>
<p><small><em>Los productos contractuales (PR0n) de esta etapa(<a href="https://hwong23.github.io/fna-dd-f2-e2/v/8f72adc093a4b90f363de89e03b42ebe89e286f8/">Web</a>)
están basados en el resultado de la consultoría “Arquitectura E-Service”,
<a href="https://stefaninilatam.sharepoint.com/:f:/r/sites/PROYECTOARQUITECTURAE-SERVICEFNA/Documentos%20compartidos/General/Repositorio%20SOA/Procesos%20Fase%20II/181-2020.%20E-SERV.%20Fase%202-ETAPA%200.%20docx?csf=1&amp;web=1&amp;e=BiNcBP">Sharepoint STEF@8f72adc</a>
del July 31, 2023.
</em></small></p>
<div class="line-block">   <strong>Versión</strong> del producto 1.8f72adc de 31 Jul 2023</div>
<p><br></p>
<h2 id="autores">Autores</h2>
<ul>
<li><p><strong>Harry Wong, ing.</strong>
<br>
· <img src="images/github.svg" class="inline_icon" width="16" height="16" alt="Usuario" />
<a href="https://github.com/e_hwong">e_hwong</a>
<br>
<small>
Arquitecto SOA, Stefanini
</small></p></li>
<li><p><strong>Wilson Morales, ing.</strong>
<br>
· <img src="images/github.svg" class="inline_icon" width="16" height="16" alt="Usuario" />
<a href="https://github.com/wmorales">wmorales</a>
<br>
<small>
Software, Aplicaciones
</small></p></li>
<li><p><strong>Flavio Hernandez, ing.</strong>
<br>
· <img src="images/github.svg" class="inline_icon" width="16" height="16" alt="Usuario" />
<a href="https://github.com/fhernandez">fhernandez</a>
<br>
<small>
SOA, Arquitectura
</small></p></li>
<li><p><strong>Viviana M. Martinez, ing.</strong>
<br>
· <img src="images/github.svg" class="inline_icon" width="16" height="16" alt="Usuario" />
<a href="https://github.com/vmmartinez">vmmartinez</a>
<br>
<small>
Analista, Proyectos
</small></p></li>
</ul>
<div id="correspondence">
<p>✉ — Enviar mensajes a Harry Wong, ing. &lt;e_hwong@stefanini.com&gt;.</p>
</div>
<p><br></p>
<h2 id="objetivo-del-documento">Objetivo del Documento</h2>
<p>Entrega de los productos de la Etapa 2, PR04. Definición de roles y responsabilidades e instalación del comité y PR05. Procesos de mejoramiento de diseño y vigilancia de riesgos técnicos, del proyecto Gobierno SOA: Políticas, flujos de trabajo y personas que ejercitan y conforman (cumplen) con el gobierno SOA del FNA a desplegar a cargo de la oficina de arquitectura.</p>
<h2 class="page_break_before" id="control-de-cambios">Control de Cambios</h2>
<table>
<colgroup>
<col style="width: 36%" />
<col style="width: 63%" />
</colgroup>
<thead>
<tr class="header">
<th>Tema</th>
<th>PRY01 Gobierno SOA FNA</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Palabras clave</td>
<td>SOA, E-Service, FNA, Análisis de brecha, GAP, Comparativa</td>
</tr>
<tr class="even">
<td>Autor</td>
<td></td>
</tr>
<tr class="odd">
<td>Fuente</td>
<td></td>
</tr>
<tr class="even">
<td>Versión</td>
<td>1.8f72adc del 31 Jul 2023</td>
</tr>
<tr class="odd">
<td>Vínculos</td>
<td><a href="N03a%a20Vsta%20aSegenta%20SOA%20FNA.md">N003a Vista Segmento SOA FNA</a></td>
</tr>
</tbody>
</table>
<p><br></p>
<p><br></p>
<div style="page-break-before: always;">

</div>
<h2 id="contenidos">Contenidos</h2>
<div style="page-break-before: always;">

</div>
<blockquote>
<p>E-Service. Fase II</p>
<p>PRY01. Gobierno SOA del FNA. Contenido de los Productos Contractuales</p>
<p>Contrato 1812020</p>
<p>FNA, Stefanini</p>
<p>31 Jul 2023</p>
<p><strong>Versión</strong> 1.8f72adc</p>
</blockquote>
<p><br></p>
<h1 id="producto-4-pr04.-definición-de-roles-y-responsabilidades-e-instalación-del-comité">Producto 4: PR04. Definición de roles y responsabilidades e instalación del comité</h1>
<p>Desarrollo de procedimientos, funciones, entregables, selección de roles y herramientas a desplegar para la puesta en marcha de un Comité de Arquitectura del FNA adscrito a la Vicepresidencia de Tecnología FNA y en cumplimiento con el Gobierno SOA, versión 0.5, objeto de este proyecto.</p>
<p><strong>Nota</strong>: los análisis de este producto están dirigidos a cumplir los objetivos del proyecto PRY01, Gobierno SOA: desarrollo, gestión, gobierno de arquitectura y adopción.</p>
<p><br></p>
<h2 id="justificación">Justificación</h2>
<p>El Comité de Arquitectura es la entidad de supervisión ubicada entre la oficina de arquitectura (PR02, objeto de este proyecto) y los líderes de grupo de productos del FNA y áreas interesadas. Es una figura necesaria dado los resultados de los diagnósticos SOA, en particular el de riesgos técnicos, realizados en la Fase I de la consultoría E-Service que señalan como causantes a la complejidad y (baja) agilidad que enfrenta el FNA. El Comité de Arquitectura funge como complemento, apoyo y arbitraje (directriz) de las decisiones concernientes a los trabajos de arquitectura del FNA dirigidos a la solución de estos problemas.</p>
<h2 id="contenidos-1">Contenidos</h2>
<ol type="1">
<li>Proceso de soporte y alineación de arquitecturas: Oficina y Negocio FN</li>
<li>Modelo operativo del Comité de Gobierno de Arquitectura del FNA: actores, información y procedimientos</li>
<li>Consideraciones para la puesta en marcha del Comité</li>
<li>Matriz de responsabilidades y procedimientos del Comité de Arquitectura</li>
<li>Método de evaluación de arquitecturas para el FNA</li>
</ol>
<p><br></p>
<h2 id="criterios-de-aceptación">Criterios de Aceptación</h2>
<ul>
<li>Entendimiento funcional y operativa del comité de arquitectura del FNA</li>
<li>Matriz de roles y procedimientos del del comité de arquitectura del FNA</li>
</ul>
<p><br></p>
<h2 id="modelo-de-implementación-del-pry01">Modelo de Implementación del PRY01</h2>
<div id="fig:45dc34cb-d5ea-473b-a409-1e07f0a98c08" class="fignos">
<figure>
<img src="images/pry1gobierno.jpg" alt="Imagen 1: Plan de Implementación del Proyecto Gobierno SOA del FNA (PRY01), 2023. Junio 2023 a julio 2023" />
<figcaption aria-hidden="true"><span>Imagen 1:</span> Plan de Implementación del Proyecto Gobierno SOA del FNA (PRY01), 2023. Junio 2023 a julio 2023</figcaption>
</figure>
</div>
<p><em>Fuente: Elaboración propia.</em></p>
<p><br></p>
<div style="page-break-before: always;">

</div>
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 79%" />
</colgroup>
<thead>
<tr class="header">
<th>Tema</th>
<th>Comité de Arquitectura del FNA: <strong>Descripción del Comité de Gobierno de Arquitecturas del FNA</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Palabras clave</td>
<td>SOA, Comité arquitectura, Procesos, Objetivos, Modelo</td>
</tr>
<tr class="even">
<td>Autor</td>
<td></td>
</tr>
<tr class="odd">
<td>Fuente</td>
<td></td>
</tr>
<tr class="even">
<td>Versión</td>
<td><strong>1.8f72adc</strong> del 31 Jul 2023</td>
</tr>
<tr class="odd">
<td>Vínculos</td>
<td><a href="onenote:#N001d.sharepoint.com">Ejecución Plan de Trabajo SOA</a>; <a href="onenote:#N003a.com">Procesos de Negocio FNA</a></td>
</tr>
</tbody>
</table>
<p><br></p>
<h1 id="modelo-operativo-del-comité-de-arquitectura-del-fna">Modelo operativo del Comité de Arquitectura del FNA</h1>
<p>A partir del modelo inicial del Comité descrito en <a href="../../fna-dd-f2-e1/content/03n.1.descripcion%20comite.md">Descripción del Comité de Gobierno de Arquitecturas del FNA</a>, en esta sección ampliaremos detalles de los conceptos operativos y de la puesta en marcha del Comité dentro del FNA.</p>
<p>Partimos de la definición de Comité de Arquitectura enunciada para el FNA.</p>
<pre><code>El Comité de Arquitectura del FNA (CAF) materializa el gobierno SOA. Lleva a cabo los procesos de aprobación de las arquitecturas y contribuye con el gobierno al realizar tareas de revisión, decisión, seguimiento (en menor grado) y divulgación de trabajos de arquitectura. </code></pre>
<p>De esta definición destacamos el rol clave que el Comité juega para el gobierno y describiremos los procesos operativos que este debe realizar y que lo constituyen como tal.</p>
<h2 id="procesos-del-comité-de-arquitectura-fna-caf">Procesos del Comité de Arquitectura FNA (CAF)</h2>
<p>Para cumplir sus objetivos y funciones (ver <a href="04.a1.modelo%20comite.md">Objetivos Específicos del CAF</a> debemos definir los procesos que este debe realizar.</p>
<p>Un error frecuente es asumir que el Comité influye en las decisiones de la empresa, o en sus estrategias. No lo hace. Tampoco en las estrategias de TI de la empresa, como son la adopción de prácticas o tecnologías que este ha determinado ya convenientes. El Comité no modifica ni controvierte este tipo de decisiones. No es un Comité de decisiones. El Comité de arquitectura, para ser exitoso, deben apegarse y apoyar a los procesos de gobierno de las arquitecturas del FNA, y ejecutar, por tanto, sus propios procesos.</p>
<pre><code>Importante. El CAF no es un Comité de decisiones porque no incide en las estrategias de negocio ni en las de TI. El Comité de arquitectura, para ser exitoso, deben apegarse y apoyar a los procesos de gobierno de las arquitecturas del FNA, y ejecutar, por tanto, sus propios procesos.</code></pre>
<p>El Comité de Arquitectura debe realizar los procesos siguientes, que a la vez, explican el por qué el FNA deben este tipo de entes de gobierno.
1. Aprobar y publicar las arquitecturas resultantes (sean reformas, adaptaciones, migraciones, o arreglos),
1. Evaluar las arquitecturas resultantes y la adherencia a la arquitectura de referencia
1. Determinar las acciones que los interesados de las nuevas arquitecturas, o sus transiciones, deben conocer para la corrección de las inconformidades
1. Divulgar conocimientos de arquitectura, entendidos como diseño, soluciones, prácticas y herramientas a los ingenieros e interesados del FNA</p>
<p><br></p>
<p>En el siguiente diagrama resumimos la actuación y colaboración del modelo operativo del Comité de Arquitectura.</p>
<div id="fig:356103c4-d9d5-4cf0-89bf-3d6f4286b66d" class="fignos">
<figure>
<img src="images/comiteModelo.png" alt="Imagen 2: Comité de Arquitectura en colaboración y cumplimiento con otras áreas del FNA." />
<figcaption aria-hidden="true"><span>Imagen 2:</span> Comité de Arquitectura en colaboración y cumplimiento con otras áreas del FNA.</figcaption>
</figure>
</div>
<p><em>Fuente: elaboración propia.</em></p>
<p><br></p>
<h2 id="conformación-del-comité-para-el-gobierno-soa-del-fna">Conformación del Comité para el Gobierno SOA del FNA</h2>
<p>El equipo del trabajo del CAF requerido, conforme el modelo de gobierno SOA presentado en este proyecto, se compone de los roles de gestión de la tecnología y arquitectura en los ámbitos de diseño de servicios SOA y componentes de software: arquitecto SOA, o quien haga las veces de este); infraestructura tecnológica y redes: arquitecto de TI; aplicaciones de solución y herramientas de software: arquitecto de aplicaciones; y del especialista de las estructuras de datos e información del negocio: Arq. de datos.</p>
<div id="fig:db139741-e623-4e84-9f58-1cbf531d9814" class="fignos">
<figure>
<img src="images/comite.png" alt="Imagen 3: Roles y Grupos de trabajo del gobierno SOA del FNA." />
<figcaption aria-hidden="true"><span>Imagen 3:</span> Roles y Grupos de trabajo del gobierno SOA del FNA.</figcaption>
</figure>
</div>
<p><em>Fuente: E-Service, Fase I (2022).</em></p>
<p><br></p>
<p>Estos recursos deben funcionar como recursos propios de la organización, sin perjuicio de que sean externos. Lo anterior, debido a la gestión de conocimiento del <em>activo más importante del gobierno SOA: las arquitecturas SOA y la arquitectura de referencia 2.0 del FNA, junto a los vínculos de estas con los contextos de negocio y TI</em>.</p>
<div style="page-break-before: always;">

</div>
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 81%" />
</colgroup>
<thead>
<tr class="header">
<th>Tema</th>
<th>Gobierno SOA del FNA: <strong>Método de evaluación de arquitecturas para el FNA</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Palabras clave</td>
<td>SOA, Evaluación de arquitectura, ATAM, Método</td>
</tr>
<tr class="even">
<td>Autor</td>
<td></td>
</tr>
<tr class="odd">
<td>Fuente</td>
<td></td>
</tr>
<tr class="even">
<td>Versión</td>
<td><strong>1.8f72adc</strong> del 31 Jul 2023</td>
</tr>
<tr class="odd">
<td>Vínculos</td>
<td><a href="onenote:#N001d.sharepoint.com">Ejecución Plan de Trabajo SOA</a>; <a href="onenote:#N003a.com">Procesos de Negocio FNA</a></td>
</tr>
</tbody>
</table>
<p><br></p>
<h1 id="método-de-evaluación-de-arquitecturas-para-el-fna-evalf">Método de Evaluación de Arquitecturas para el FNA (EVALF)</h1>
<p>La evaluación arquitectónica es la máxima en el cumplimiento tanto del Gobierno SOA del FNA, versión 0.6 (incluye riesgos técnicos) como de la misión del propio Comité de Arquitectura del Fondo (CAF). Este ejercicio, de realizarse reduce el esfuerzo y los costos de desarrollo de las soluciones de servicios y software, y guarda la calidad al verificar la dirección y sentido de los requisitos y al identificar los riesgos potenciales.</p>
<p>El objetivo de los evaluadores (arquitectos de la oficina, normalmente) proporcionen garantías a los ingenieros, desarrolladores, proveedores y fábricas de software del FNA de que la arquitectura elegida cumplirá con los requisitos de calidad, tanto funcionales como no funcionales.</p>
<pre><code>La evaluación de arquitectura, como está definida aquí, proporcione garantías a los ingenieros, desarrolladores, proveedores y fábricas de software del FNA de que el diseño elegido cumplirá con los requisitos de calidad funcionales y sistémicos (no funcionales).

Importante. Una máxima de la evaluación de arquitectura es que debe traer más beneficios que costos.</code></pre>
<p>En este aparte desarrollaremos el método de evaluación de arquitecturas acondicionado para la Oficina y el Comité de Arquitectura (CAF) del Fondo, tal que cumpla con las características determinadas en (<a href="../../fna-dd-f2-e1/content/03n.3.evaluacion.md">Características del Método de Evaluación de Arquitecturas</a>) para esta herramienta.</p>
<p>Las características que el método de evaluación debe cumplir son las indicadas en la siguiente table.</p>
<div id="tbl:atam-id" class="tablenos">
<table id="tbl:atam-id">
<caption><span>Tabla 1:</span> Características que cumple el método de evaluación de arquitectura (MEVFNA) seleccionado para el FNA. </caption>
<colgroup>
<col style="width: 26%" />
<col style="width: 73%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>1. Organización</strong></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td>1. Riesgos técnicos</td>
</tr>
<tr class="even">
<td></td>
<td>2. Puntos de Sensibilidad al Cambio</td>
</tr>
<tr class="odd">
<td></td>
<td>3. Compensaciones</td>
</tr>
<tr class="even">
<td></td>
<td>4. Costo / Beneficio</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td><strong>2. Elementos</strong></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>1. Escenarios de calidad</td>
</tr>
<tr class="even">
<td></td>
<td>2. Sistema de puntuación</td>
</tr>
<tr class="odd">
<td></td>
<td>3. Árbol de utilidad (diversificación)</td>
</tr>
</tbody>
</table>
</div>
<p><br></p>
<h1 id="evaluación-de-arquitecturas-fna-basada-en-escenarios-asam">Evaluación de Arquitecturas FNA Basada en Escenarios (ASAM)</h1>
<p>La evaluación por escenarios (ASAM, por sus siglas en inglés) basado en ATAM del Open Group, ofrece una manera efectiva (en comparación con otros métodos <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>) de encontrar el valor de aptitud de una arquitectura de servicios o de software respecto a atributos de calidad competitivos.</p>
<p>El principal valor de la evaluación por escenarios es contestar de manera sistemática la pregunta de control: ¿puede esta arquitectura o no ejecutar este escenario? La evaluación debe determinar los componentes de la arquitectura implicados en el resultado a favor o no de la pregunta de control. Si la arquitectura falla en el propósito de ejecutar el escenario, es obligatorio del método dar parte de la lista de cambios en la arquitectura que sean requeridos para soportarlo, y por supuesto, estimar su costo/beneficio.</p>
<pre><code>Importante. El valor de la evaluación por escenarios es contestar de manera sistemática la pregunta de control: ¿puede esta arquitectura o no ejecutar este escenario?, y estimar el costo/beneficio del cambio.</code></pre>
<p>El método por escenarios, ASAM, ayuda además a encontrar <em>arquitecturas candidatas</em>, o cambios interesantes sobre una arquitectura ejecutable. Las arquitecturas o cambios candidatos se describen en términos de los elementos arquitectónicos de interés (componentes de la arquitectura, o del software) para cada uno de los atributos de calidad.</p>
<p>En la siguiente ilustración resumimos las acciones y relaciones que este método requiere.</p>
<div id="fig:429a9916-8c3a-4c3f-8932-40cd3c3826a7" class="fignos">
<figure>
<img src="images/evaluacion.png" alt="Imagen 4: Modelo de evaluación de las arquitecturas del FNA. Evaluación basada en escenarios de valor." />
<figcaption aria-hidden="true"><span>Imagen 4:</span> Modelo de evaluación de las arquitecturas del FNA. Evaluación basada en escenarios de valor.</figcaption>
</figure>
</div>
<p><em>Fuente: elaboración propia.</em></p>
<p><br></p>
<p>Los atributos de calidad de sistemas que pueden usarse como referencia para el método propuesto de evaluación son los indicados en la imagen siguiente.</p>
<div id="fig:2132097d-5f39-414d-9b8b-bc91bbcd670b" class="fignos">
<figure>
<img src="images/atributoseval.png" alt="Imagen 5: Atributos: puntos de sensibilidad y de decisión de arquitecturas para el ASAM propuesto (método de evaluación basado en escenarios)" />
<figcaption aria-hidden="true"><span>Imagen 5:</span> Atributos: puntos de sensibilidad y de decisión de arquitecturas para el ASAM propuesto (método de evaluación basado en escenarios)</figcaption>
</figure>
</div>
<p><em>Fuente: elaboración propia.</em></p>
<p><br></p>
<p>Al final, el método propuesto debe entregar información accionable y de soporte de decisiones y planeación para la actualización/o no, de la plataforma tecnológica del SIAFP.</p>
<h2 id="proceso-de-evaluación-basado-en-escenarios-asam">Proceso de Evaluación Basado en Escenarios (ASAM)</h2>
<p>Descripción del modelo de evaluación propuesto.</p>
<p>Para la evaluación de arquitectura y proveedores utilizaremos el proceso sugerido por los métodos de basados en escenarios. En este tipo de procesos la parte central es la selección y elaboración de los escenarios tanto técnicos como de negocio.</p>
<h3 id="descripción-de-escenarios-directos">0. Descripción de escenarios directos</h3>
<p>La descripción de escenarios se la realizará mediante un diagrama dinámico de flujo de trabajo. Ejemplo.</p>
<div id="fig:36859b79-ca9a-4ab1-83e9-a397b03b2fd8" class="fignos">
<figure>
<img src="images/eval0.descripcion.png" alt="Imagen 6: Proceso de evaluación y decisión de arquitecturas ASAM del FNA." />
<figcaption aria-hidden="true"><span>Imagen 6:</span> Proceso de evaluación y decisión de arquitecturas ASAM del FNA.</figcaption>
</figure>
</div>
<p><em>Fuente: ASAM. Department of CSE, SCSVMV University.</em></p>
<h3 id="priorización-de-escenarios">0.1. Priorización de escenarios</h3>
<p>La priorización de escenarios se la realizará por votación. La votación estará a cargo de los arquitectos de la Oficina FNA.</p>
<div id="fig:e8922325-9e9a-4e70-a7e8-e17c4d43ef1d" class="fignos">
<figure>
<img src="images/eval1.descripcion.png" alt="Imagen 7: Proceso de evaluación y decisión de arquitecturas ASAM del FNA." />
<figcaption aria-hidden="true"><span>Imagen 7:</span> Proceso de evaluación y decisión de arquitecturas ASAM del FNA.</figcaption>
</figure>
</div>
<p><em>Fuente: ASAM. Department of CSE, SCSVMV University.</em></p>
<h3 id="evaluación-de-escenarios">1. Evaluación de escenarios</h3>
<p>Para la evaluación de los escenarios se utilizará una variante del método cualitativo. Los criterios de la evaluación se basarán en la criticidad del riesgo del componente, en lugar, de cantidad de componentes, indicada en el siguiente ejemplo.</p>
<div id="fig:3cfcf055-9cf9-4afe-b090-c2ceb7f94d57" class="fignos">
<figure>
<img src="images/eval2.descripcion.png" alt="Imagen 8: Proceso de evaluación y decisión de arquitecturas ASAM del FNA." />
<figcaption aria-hidden="true"><span>Imagen 8:</span> Proceso de evaluación y decisión de arquitecturas ASAM del FNA.</figcaption>
</figure>
</div>
<p><em>Fuente: ASAM. Department of CSE, SCSVMV University.</em></p>
<h3 id="comparación-de-escenarios">2. Comparación de escenarios</h3>
<p><strong>Nota</strong>. Por cada arquitectura se evalúan los mismos escenarios.</p>
<p>Si por cada requerimiento de negocio/técnico, se obtienen varios escenarios, se realizará la comparativa de puntos entre los escenarios donde el mejor puntaje gana. El sistema de puntuación para los escenarios es el propuesto a continuación.</p>
<div id="fig:88c289e7-3283-4a7b-8499-52c896c33c0b" class="fignos">
<figure>
<img src="images/eval3.descripcion.png" alt="Imagen 9: Proceso de evaluación y decisión de arquitecturas ASAM del FNA." />
<figcaption aria-hidden="true"><span>Imagen 9:</span> Proceso de evaluación y decisión de arquitecturas ASAM del FNA.</figcaption>
</figure>
</div>
<p><em>Fuente: ASAM. Department of CSE, SCSVMV University.</em></p>
<h3 id="salidas-del-proceso-de-evaluación">3. Salidas del Proceso de Evaluación</h3>
<ul>
<li>SAL01. Análisis de Sensibilidad: Decisiones de arquitectura que impacta positivamente al negocio.</li>
<li>SAL02. Mapa de Riesgos Arquitectónicos: Son aquellos para los que no hay valor satisfactorio como respuesta a una acción desde un enfoque arquitectónico.</li>
<li>SAL03. Lista de Conformidades (no-riesgos)</li>
<li>SAL04. Resultado del Cuestionario de evaluación (respuestas a preguntas de análisis)</li>
</ul>
<p><br></p>
<div style="page-break-before: always;">

</div>
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 81%" />
</colgroup>
<thead>
<tr class="header">
<th>Tema</th>
<th>Gobierno SOA del FNA: <strong>Proceso de soporte y alineación de arquitecturas: Oficina y Negocio FNA</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Palabras clave</td>
<td>SOA, Evaluación de arquitectura, ASAM, Método</td>
</tr>
<tr class="even">
<td>Autor</td>
<td></td>
</tr>
<tr class="odd">
<td>Fuente</td>
<td></td>
</tr>
<tr class="even">
<td>Versión</td>
<td><strong>1.8f72adc</strong> del 31 Jul 2023</td>
</tr>
<tr class="odd">
<td>Vínculos</td>
<td><a href="onenote:#N001d.sharepoint.com">Ejecución Plan de Trabajo SOA</a>; <a href="onenote:#N003a.com">Procesos de Negocio FNA</a></td>
</tr>
</tbody>
</table>
<p><br></p>
<h1 id="proceso-de-soporte-y-alineación-de-arquitecturas-con-negocio-fna">Proceso de Soporte y Alineación de Arquitecturas con Negocio FNA</h1>
<h2 id="identificar-y-priorizar-los-casos-de-uso-significativos">Identificar y Priorizar los Casos de Uso Significativos</h2>
<p>La primera tarea que debe ser realizada durante la definición de la arquitectura del proyecto es identificar los requerimientos funcionales y no funcionales que son significativos para la arquitectura objetivo. El capítulo de visión dentro de la <a href="../../fna-dd-f2-e1/content/02n.2a.oficina.md">Especificación Trabajo de Arquitectura</a> dada, sumado a los requerimientos definidos en la etapa de levantamiento de los líderes de grupo del FNA son los insumos que le permiten al arquitecto involucrado identificar aquellos requerimientos que influencian la arquitectura de manera significativa.</p>
<p>Los requerimientos identificados como significativos son los que se documentan en la <a href="https://stefaninilASAM.sharepoint.com/SitePages/Home.aspx">vista de casos de uso</a> del documento de arquitectura.</p>
<h2 id="establecer-la-arquitectura-candidata">Establecer la Arquitectura Candidata</h2>
<p>El propósito de esta actividad es definir el bosquejo inicial de la arquitectura del sistema. Esta actividad se basa en revisar las experiencias pasadas de la organización (Revisión de la base de datos de conocimiento), la arquitectura candidata toma en cuenta los requerimientos funcionales y no funcionales (disponibilidad, desempeño, escalabilidad) del sistema.</p>
<p>Ej. Una arquitectura en N-capas donde la aplicación es WEB-enabled, que probablemente será el acceso a través de Web Services en un futuro cercano.</p>
<p>Para seleccionar la arquitectura se debe utilizar el proceso de PR-TDEC-001-Toma de Decisiones, dado que es necesario que el arquitecto plantee más de una alternativa de solución, defina escenarios de operación del sistema, defina criterios, evalúe y documente la decisión final.</p>
<h2 id="definir-el-modelo-de-despliegue-inicial">Definir el Modelo de Despliegue Inicial</h2>
<p>En este punto se define un diagrama de alto nivel de despliegue del nuevo sistema. En este diagrama se muestran los diferentes nodos en los cuales va a operar el nuevo sistema, así como los posibles escenarios de infraestructura en que se va a ejecutar el nuevo sistema.</p>
<h2 id="identificar-los-elementos-claves-de-diseño-en-la-arquitectura">Identificar los Elementos Claves de Diseño en la Arquitectura</h2>
<p>A partir de los documentos de requerimientos (Visión, Casos de Uso, Glosarios, Requerimientos no funcionales) el arquitecto puede extraer los elementos técnicos y conceptuales claves de la solución. En este estado, es importante definir los elementos de vocabulario comunes al proyecto en la fase implementación.</p>
<p>Algunos ejemplos de elementos claves de la solución son:</p>
<ul>
<li>Integración con sistemas legados</li>
<li>Concurrencia</li>
<li>Persistencia</li>
<li>Uso de tecnología desconocida por el equipo de trabajo</li>
<li>Históricos</li>
<li>Seguridad</li>
<li>Auditoría</li>
<li>Tolerancia a Fallos</li>
<li>Refinar el modelo de análisis</li>
</ul>
<p><br></p>
<p>El objetivo de esta actividad es complementar y refinar el análisis realizado para los casos de uso identificados en el paso 1.</p>
<p>En este punto se vincula el modelo de análisis de los casos de uso significativos elaborados en la etapa de análisis del proyecto.</p>
<p>Los elementos de análisis son todas las clases de análisis involucradas en la realización de los casos de uso. Tradicionalmente las clases son asociadas al estereotipo de análisis. Para cada realización significativa de casos de uso, el propósito es definir los aspectos estáticos y dinámicos del caso de uso. Como resultado del análisis se deben identificar todas las clases de diseño posibles, estas son las que se agrupan para definir los componentes funcionales de la aplicación, para efectos de arquitectura en esta fase se definen los componentes funcionales que componen la aplicación.</p>
<p>El modelo de análisis puede ser reutilizado para muchas diferentes implementaciones. Y la definición para sus componentes debe ser administrada por el área de procesos.</p>
<h2 id="elaborar-el-modelo-de-diseño">Elaborar el Modelo de Diseño</h2>
<p>Una vez que las realizaciones de los casos de uso han sido documentadas en el modelo de análisis, es tiempo de profundizar y bajar al diseño concreto de los componentes.</p>
<p>Mientras que el modelo de análisis es abstracto, el modelo del diseño debe estar mucho más cerca de la implementación real. El arquitecto de software necesita identificar una tecnología para implementar la solución. El arquitecto debe estar en capacidad de diseñar los mecanismos, tomando ventaja de los elementos que le brinda la tecnología.</p>
<p>El modelo define las dependencias entre las capas del negocio que serán registradas en el documento de arquitectura, utilizando UML como lenguaje de modelamiento, y los diagramas de clases, de estados, de secuencia y colaboración, como mecanismos para mostrar el diseño estático y dinámico de la aplicación.</p>
<p>Las especificaciones de los componentes.</p>
<p>Este es el primer aspecto que un arquitecto de software debe definir, para cada componente es importante especificar los datos que éste manipula (DTO’s) y sus interfaces, incluyendo las operaciones disponibles.</p>
<p>La realización de los casos de uso estarán en el lugar de diseñar las vistas dinámicas y estáticas de un componente utilizando diagramas de clases y de secuencia.</p>
<p>Paquetes de implementación de análisis.</p>
<p>Luego es necesario definir el detalle de diseño de cada componente. Esto se hace en un paquete específico llamado diseño de implementación.</p>
<p>Implementando Paquetes de Diseño.</p>
<p>Aquí es importante definir todas las clases con sus atributos y operaciones. Esta tarea no es siempre responsabilidad del arquitecto de software. Dependiendo del tamaño del equipo el rol de diseñador de software puede ser asignado a una o a varias personas.</p>
<p>Diagrama de clase de los componentes del sistema</p>
<p>Durante esta fase el arquitecto también completa un prototipo de operación del sistema. Este es el prototipo evolutivo, el cual es la base que será utilizada como punto de partida en la fase de construcción.</p>
<p>Establecer el modelo de paquetes y divisiones del sistema.</p>
<p>El modelo de implementación es el que contiene el código fuente del sistema, como labor del diseño de la arquitectura se debe definir la estructura de los mismos, y publicarla para uso del equipo de trabajo del proyecto.
Documentar los mecanismos de operación de los elementos claves.<br />
El propósito de esta actividad es dejar en papel las guías de trabajo para los mecanismos que requiere el sistema, se trata de documentar las soluciones técnicas a los elementos claves del desarrollo definidos en el paso 4 de este procedimiento,</p>
<p>Para la documentación de estos mecanismos el arquitecto debe utilizar los artefactos de UML que considere necesarios para especificar la solución que le sirva de guía a los diseñadores y desarrolladores para ejecutar el desarrollo. Para el diseño de los mecanismos se utiliza el procedimiento de diseño (4.3 Realizar Diseño).</p>
<p>Por ejemplo, para el caso de concurrencia el arquitecto puede elaborar un modelo de despliegue, donde el arquitecto ilustra, por ejemplo, que la solución maneja un cluster para balanceo de carga.</p>
<h2 id="elaborar-la-estrategia-de-implementación">Elaborar la estrategia de implementación</h2>
<p>Como parte importante de la arquitectura, está la definición de la estrategia de desarrollo del proyecto, se trata de definir la forma como se debe priorizar los diferentes elementos y componentes del desarrollo de tal forma que se cumplan los objetivos del proyecto. La estrategia es el mecanismo con el que cuenta el arquitecto para mitigar los riesgos desde la visión técnica del proyecto.</p>
<p>Cuando se trata de proyectos donde se desconoce el negocio y el grupo de trabajo desconoce la tecnología, la decisión sobre la estrategia de desarrollo es vital para el proyecto, por esta razón se deben plantear diferentes alternativas, definir criterios de selección, evaluarlas y documentar la alternativa ganadora, en este punto se debe hacer uso del proceso PR-TDEC-001-Toma de Decisiones.</p>
<h2 id="solicitar-revisión-de-la-arquitectura---asam">Solicitar Revisión de la arquitectura - ASAM</h2>
<p>El Gerente o el Arquitecto del Proyecto debe someter el diseño al comité de Arquitectura quienes realizarán la revisión correspondiente aplicando el Método ASAM (Architecture Scenario Analysis Method).</p>
<h2 id="planeación-de-la-evaluación">Planeación de la evaluación</h2>
<p>El equipo evaluador se reúne con los principales stakeholders del proyecto a evaluar para crear un plan de evaluación. Las personas que participan en este paso son el gerente del proyecto cliente, y líder de equipo ASAM.</p>
<h2 id="presentación-de-proceso-asam">Presentación de proceso ASAM</h2>
<p>El equipo evaluador hace una presentación del proceso ASAM y de las actividades que se llevarán a cabo para ejecutarlo. Para esto se debe contar con el proceso ASAM utilizando el documento (documento o anexo técnico Evaluación ASAM) y realizar la presentación de evaluación ASAM (documento o anexo técnico Presentación ASAM). Luego de realizar la presentación los stakeholders estarán preparados para la evaluación.</p>
<p>En esta labor participan el Gerente del proyecto evaluado, Arquitecto del proyecto evaluado, Stakeholders con poder de decisión y el equipo evaluador.</p>
<h2 id="presentación-de-motivadores-de-negocio">Presentación de Motivadores de Negocio</h2>
<p>El gerente del proyecto que está siendo evaluado hace una presentación de los motivadores de negocio (documento o anexo técnico Plantilla_motivadores_de_negocio). Para esto se hace uso de la plantilla de presentación de motivadores de negocio y como resultado de esta labor se definen:</p>
<ul>
<li>Los atributos de calidad</li>
<li>Las restricciones técnicas, económicas, administrativas o políticas</li>
<li>Los objetivos de negocio</li>
<li>Motivadores arquitecturales</li>
</ul>
<p><br></p>
<p>Participan de esta labor el Gerente del proyecto evaluado, el Arquitecto del proyecto evaluado y el equipo evaluador.</p>
<h2 id="presentación-de-la-arquitectura">Presentación de la Arquitectura</h2>
<p>Teniendo en cuenta la presentación de arquitectura, los atributos de calidad identificados y las restricciones.</p>
<p>El arquitecto del proyecto evaluado hace una presentación de la arquitectura del sistema mediante documento o anexo técnico. Debe explicarla con un nivel de detalle suficiente para el tiempo con que se cuenta, la cantidad de diseño elaborado, documentación disponible y naturaleza de los requerimientos.</p>
<p>Durante esta evaluación el equipo debe verificar que el arquitecto haya tenido en cuenta los elementos identificados en la presentación de los motivadores de negocio. También debe hacer las preguntas.</p>
<p>Se deben establecer como salida los enfoques arquitecturales, estrategias de solución de atributos de calidad, trazabilidad entre algunos escenarios y como los enfrenta la arquitectura.</p>
<p>En esta labor participan el Gerente del proyecto, el Arquitecto del proyecto evaluado y el equipo evaluador.</p>
<h2 id="identificar-enfoques-de-solución-de-arquitectura">Identificar Enfoques de Solución de Arquitectura</h2>
<p>Teniendo en cuenta la documentación de la arquitectura, la presentación de la arquitectura y los patrones arquitectónicos, en este paso el equipo evaluador se enfoca simplemente en catalogar los patrones y enfoques evidentes. Esta lista es capturada públicamente y sirve para el análisis posterior.</p>
<p>El equipo evaluador debe obtener los patrones que se usan explícitamente de acuerdo con la presentación de la arquitectura y a la documentación disponible. Además, deben analizar la solución para encontrar patrones que no sean mencionados o de los que quizá el arquitecto no es consciente.</p>
<p>Como resultado de este paso se obtiene el catálogo de patrones y los enfoques arquitecturales usados en la solución y participan el Arquitecto del proyecto evaluado y el equipo evaluador.</p>
<h2 id="generar-árbol-de-utilidad">Generar Árbol de Utilidad</h2>
<p>Se tienen en cuenta los atributos de calidad identificados y las presentaciones sobre la arquitectura y los motivadores de negocio</p>
<p>En este paso trabajan conjuntamente el equipo evaluador, el arquitecto o grupo de arquitectura, el gerente del proyecto y posiblemente un representante del cliente para identificar, priorizar y refinar los atributos de calidad más importantes. Este paso tiene un enfoque descendente (top down).</p>
<p>El proceso para generar el árbol de utilidad es el siguiente:</p>
<ol type="1">
<li>Crear el nodo padre llamado Utilidad.</li>
<li>Agregar como hijos del nodo raíz los atributos de calidad identificados en los pasos anteriores, * especialmente en la presentación de motivadores de negocio y la presentación de la arquitectura. * Ejemplos de estos atributos de calidad son: Rendimiento, Mantenibilidad, Disponibilidad.</li>
<li>Cada atributo de calidad es refinado con elementos más específicos de cara a la generación de * escenarios. Por ejemplo, Rendimiento puede ser descompuesto en latencia de datos y rendimiento de la * transacción. Este refinamiento está directamente relacionado con la caracterización del atributo de * calidad.</li>
<li>Como hojas del árbol de utilidades se agregan escenarios a cada refinamiento de los atributos de * calidad. Un escenario debe tener un estímulo, un entorno y una respuesta. Por ejemplo: “Bajo * condiciones normales de ejecución el almacenamiento de un cliente en BD debe tomar como máximo 10 * segundos”.</li>
<li>Ahora los stakeholders con poder de decisión asignan una prioridad a cada escenario según su * importancia. Cada escenario puede ser marcado de prioridad Alta, Media o Baja.</li>
<li>El arquitecto prioriza los escenarios basados en cuan complejo va a ser para la arquitectura * satisfacerlo.</li>
<li>Para la generación del árbol de utilidad tenga en cuenta estos tres tipos de escenarios:</li>
<li>Casos de Uso: El comportamiento que el usuario espera del sistema.</li>
<li>Evolución: Anticipar cambios típicos al sistema.</li>
<li>Exploración: Escenarios que estresan el sistema. Su objetivo es descubrir los límites del diseño * actual.</li>
</ol>
<p>A partir de la segunda iteración en este paso se realiza una revisión y refinamiento del árbol previamente elaborado.</p>
<p>Como resultado de la generación del árbol, habrá un listado de los escenarios priorizados por importancia y dificultad.</p>
<h2 id="definición-y-priorización-de-escenarios">Definición y Priorización de Escenarios</h2>
<p>Este paso tiene como objetivo reunir todos los stakeholders importantes del proyecto y generar un listado de escenarios para priorizar y analizar posteriormente. Con esta tarea se puede medir la alineación entre el diseño del arquitecto y los deseos reales de los stakeholders.</p>
<p>Dado que esta tarea marca el comienzo de la segunda fase de la evaluación, debe comenzar con un repaso de la metodología ASAM y una guía sobre la generación de escenarios.</p>
<p>Todos los participantes aportan escenarios relacionados con lo que será su interacción con el sistema. Por ejemplo, un líder técnico puede referirse a la mantenibilidad, un líder de pruebas sobre la facilidad de realizar pruebas funcionales y vendedor sobre características de rendimiento y flexibilidad que faciliten su tarea.</p>
<p>Los stakeholders pueden revisar los escenarios y mezclar varios que apunten hacia el mismo objetivo o dividir escenarios que afecten muchos atributos de calidad.</p>
<p>Con el listado de escenarios preparado, se pasa al proceso de priorización que consiste en asignar a cada stakeholder un número de puntos igual al 30% del número de escenarios redondeado hacia arriba, por ejemplo, para 20 escenarios cada usuario tendrá 6 votos. Cada stakeholder debe repartir sus puntos entre los escenarios disponibles de la forma que él quiera, por ejemplo, asignando 2 puntos a 3 escenarios o asignar 6 a uno sólo.</p>
<p>El líder de la evaluación ordena los escenarios por número de votos. El grupo selecciona los escenarios principales para ser evaluados. Puede ser seleccionando los n primeros o todos los escenarios con más de x puntos.</p>
<p>El líder de la evaluación debe comparar los escenarios generados en esta actividad contra los escenarios del árbol de utilidad para verificar si el arquitecto pasó por alto algunos requerimientos y si la visión del arquitecto está alineada con la de los stakeholders.</p>
<p>Como resultado de esta labor se obtiene un nuevo grupo de escenarios priorizado y participan los stakeholders representativos del proyecto y el equipo evaluador.</p>
<h2 id="evaluar-arquitectura-vs-escenarios">Evaluar Arquitectura vs Escenarios</h2>
<p>Teniendo en cuenta el árbol de utilidades, los enfoques y patrones identificados, el formato PT-INGE-031-Análisis arquitectónico de escenarios, los patrones arquitectónicos con sus ventajas y desventajas asociadas y la caracterización de los atributos de calidad, se realizan lo siguiente:</p>
<p>El equipo evaluador selecciona el grupo de escenario más importantes. Debe seleccionar un número de acuerdo con el tiempo con que se cuenta para la evaluación y a lo pactado con el cliente.
El arquitecto debe explicar como la arquitectura soporta cada escenario.
Los miembros del equipo evaluador verifican/prueban cada enfoque arquitectural y su interpretación sea apropiada para ajustarse al atributo de calidad específico.
Durante el transcurso de la evaluación del escenario los evaluadores documentan:</p>
<ul>
<li>Decisiones arquitecturales relevantes</li>
<li>Riesgos</li>
<li>No riesgos</li>
<li>Puntos sensibles</li>
<li>Compensaciones</li>
</ul>
<p><br></p>
<p>Para la evaluación de cada escenario se puede usar el formato “Formato de Análisis Arquitectónico de Escenarios”. Para cada escenario analizado, se tienen en cuenta: Decisiones más importantes, Riesgos, No riesgos, Puntos Sensibles, Puntos de Compensación.</p>
<h2 id="conciliación-de-resultados">Conciliación de Resultados</h2>
<p>Teniendo en cuenta el análisis de los escenarios el equipo evaluador revisa con el equipo evaluado una versión preliminar de los hallazgos y realizan una conciliación de éstos. Ambos equipos deben estar de acuerdo en los resultados que se presentarán en la reunión con todos los stakeholders.</p>
<p>En esta labor participan el Gerente del proyecto evaluado, el Arquitecto del proyecto evaluado, el Líder del equipo ASAM y el Líder de la evaluación con el fin de que la información como riesgos, no riesgos, puntos sensibles y puntos de compensación estén completos.</p>
<h2 id="correcciones-según-evaluación">Correcciones Según Evaluación</h2>
<p>Teniendo en cuenta el reporte de la evaluación de los escenarios (Riesgos, no riesgos, puntos sensibles, puntos de compensación) y si hay nuevos escenarios/ítems por evaluar El arquitecto realiza los ajustes necesarios para continuar con la evaluación. Estos ajustes pueden ser:</p>
<ul>
<li>Mejorar la documentación de la arquitectura</li>
<li>Aclarar Requerimientos no Funcionales (RNF)</li>
<li>Aclarar motivadores de negocio</li>
<li>Documentar nuevos artefactos/decisiones</li>
</ul>
<p><br></p>
<p>Luego de realizar estas labores se define el plan para la siguiente iteración.</p>
<p>Primera parte de presentación de resultados (hallazgos)<br />
Teniendo en cuenta la documentación presentada en los pasos anteriores, el equipo evaluador hace una presentación de los hallazgos encontrados y conciliados durante la evaluación.</p>
<p>Como resultado de esta labor se tiene el informe con los resultados de la evaluación (Enfoques arquitecturales documentados, Listado de la lluvia de escenarios y su priorización, Árbol de utilidades, Riesgos, No riesgos, Puntos sensibles y de compensación). Participan de esta labor el equipo Evaluador y el equipo Evaluado.</p>
<h2 id="segunda-parte-de-presentación-de-resultados-mitigación-de-riesgos">Segunda parte de presentación de resultados (Mitigación de riesgos)</h2>
<p>El arquitecto y el equipo evaluado presentan un listado de las actividades que se usarán para mitigar los hallazgos encontrados por el equipo evaluador.</p>
<p>Como resultado se deben crear las actividades propuestas para mitigar los hallazgos.</p>
<h2 id="revisión-y-seguimiento-de-la-arquitectura">Revisión y seguimiento de la arquitectura</h2>
<p>La definición de la arquitectura es una tarea que se hace durante todo el ciclo del proyecto y su documento está vivo a través de todo el ciclo de vida, aunque su énfasis es en las primeras etapas del proyecto. El arquitecto debe someter su diseño a la revisión de pares para la cual utiliza la lista de chequeo definida en la hoja “Arquitectura” del producto de trabajo PT-INGE-028-Listas de chequeo.</p>
<p>Así mismo el arquitecto es el responsable de hacer seguimiento del cumplimiento de la arquitectura durante todo el proyecto, para esto diligencia la revisión de los documentos de diseño y del documento de arquitectura.</p>
<p><strong>Nota</strong>. Tenga en cuenta que el documento de arquitectura resume los temas más relevantes de los productos de trabajo de otras fases del proyecto, en la mayoría de los casos se crean vínculos a los documentos en donde están los productos de trabajo mencionados.</p>
<div style="page-break-before: always;">

</div>
<blockquote>
<p>E-Service. Fase II</p>
<p>PRY01. Gobierno SOA del FNA. Contenido de los Productos Contractuales</p>
<p>Contrato 1812020</p>
<p>FNA, Stefanini</p>
<p>31 Jul 2023</p>
<p><strong>Versión</strong> 1.8f72adc</p>
</blockquote>
<p><br></p>
<h1 id="producto-5-pr05.-procesos-de-mejoramiento-de-diseño-y-vigilancia-de-riesgos-técnicos">Producto 5: PR05. Procesos de mejoramiento de diseño y vigilancia de riesgos técnicos</h1>
<p>Uno de los principales valores que un Gobierno entrega es la identificación y la gestión de las acciones para controlar los riesgos. Y en el caso de este ejercicio de gobierno trataremos los riesgos de tecnología y de arquitectura SOA del FNA consignados en el estudio E-Service, Fase I (2022).</p>
<p>El producto 5 es el detalle de los procedimientos y técnicas de tratamiento y modelamiento diseñadas para la operación de los riesgos técnicos del FNA consignados en el estudio E-Service, Fase I (2022).</p>
<p><strong>Nota</strong>: los análisis de este producto están dirigidos a cumplir los objetivos del proyecto PRY01, Gobierno SOA: desarrollo, gestión, gobierno de arquitectura y adopción.</p>
<p><br></p>
<h2 id="justificación-1">Justificación</h2>
<p>El tratamiento de los riesgos tecnológicos identificados en el diagnóstico SOA de Fase I, E-Service (2022) (ver <a href="N03a%a20Vsta%20aSegenta%20SOA%20FNA.md">03.Fase 1 PR3 Resultado Diagnóstico Situación Actual</a>) exigen acciones tal que mitiguen y adviertan al FNA sobre los impactos que estos comportan. El desarrollo de la vigilancia de los riesgos técnicos entra a reforzar al gobierno SOA del Fondo Nacional del Ahorro en curso en este proyecto y resulta en la personalización y aplicación de métodos que den tratamiento a estos. Además, operar los riesgos técnicos es de carácter obligatorio, dado que es un objetivo del Gobierno SOA del FNA: objetivo Vigilancia del riesgo tecnológico (G-OBJ1).</p>
<h2 id="contenidos-2">Contenidos</h2>
<ol type="1">
<li>Definición e identificación del riesgo técnico del FNA (E-Service, Fase I)</li>
<li>Métodos para el tratamiento de los riesgos técnicos E-Service Fase I</li>
<li>Modelamiento del riesgo técnico del FNA (Oficina de Arquitectura FNA)</li>
</ol>
<p><br></p>
<h2 id="criterios-de-aceptación-1">Criterios de Aceptación</h2>
<ul>
<li>Procedimientos y técnicas de modelamiento para el tratamiento de los riesgos técnicos del FNA (E-Service, 2022)</li>
<li>Matriz de riesgos técnicos e impactos del FNA</li>
</ul>
<p><br></p>
<h2 id="modelo-de-implementación-del-pry01-1">Modelo de Implementación del PRY01</h2>
<div id="fig:793d6517-ffbd-4c09-945e-7bbc8993c971" class="fignos">
<figure>
<img src="images/pry1gobierno.jpg" alt="Imagen 10: Plan de Implementación del Proyecto Gobierno SOA del FNA (PRY01), 2023. Junio 2023 a julio 2023" />
<figcaption aria-hidden="true"><span>Imagen 10:</span> Plan de Implementación del Proyecto Gobierno SOA del FNA (PRY01), 2023. Junio 2023 a julio 2023</figcaption>
</figure>
</div>
<p><em>Fuente: Elaboración propia.</em></p>
<p><br></p>
<div style="page-break-before: always;">

</div>
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 79%" />
</colgroup>
<thead>
<tr class="header">
<th>Tema</th>
<th>Gobierno SOA del FNA: <strong>Riesgo Técnico de Arquitectura del FNA</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Palabras clave</td>
<td>SOA, Contexto, Áreas, Procesos, Objetivo</td>
</tr>
<tr class="even">
<td>Autor</td>
<td></td>
</tr>
<tr class="odd">
<td>Fuente</td>
<td></td>
</tr>
<tr class="even">
<td>Versión</td>
<td><strong>1.8f72adc</strong> del 31 Jul 2023</td>
</tr>
<tr class="odd">
<td>Vínculos</td>
<td><a href="onenote:#N001d.sharepoint.com">Ejecución Plan de Trabajo SOA</a>; <a href="onenote:#N003a.com">Procesos de Negocio FNA</a></td>
</tr>
</tbody>
</table>
<p><br></p>
<h1 id="definición-de-riesgo-técnico-de-arquitectura-del-fna">Definición de Riesgo Técnico de Arquitectura del FNA</h1>
<p>Es importante adoptar una definición de lo que es el riesgo técnico en el contexto de este proyecto. La definición ayudará en el logro de los objetos de este proyecto, identificar y realizar las estructuras de información y los diseños que los mitiguen.</p>
<p>Para la definición de riesgo técnico de las arquitecturas del FNA, en el contexto de este proyecto, utilizaremos un ejemplo de un caso existente en el FNA.</p>
<pre><code>De las problemáticas encontradas en la Fase 1 del presente diagnóstico, nos referimos explícitamente a las que incrementan la complejidad de las soluciones SOA y soluciones de software del FNA, _como el manejo de dependencias de los servicios SOA del Fondo_. Es conocido y demostrado que solo esta condición es parte de la causa de los sobreesfuerzos que se dan en la evolución de dichas soluciones, y de las dificultades que se encuentran en los análisis de impacto de estos cambios (E-Service, Fase I, 2022).</code></pre>
<p>Por otro lado, miremos aproximaciones y definiciones de riesgo técnico generalmente aceptadas, como la enunciada por la ISO 31000:2009, o la del Enterprise Risk Management que citamos a continuación:</p>
<pre><code>Partimos de la diferenciación del concepto de riesgo de la empresa y del profesional de la gestión de riesgos (ERM, o Enterprise Risk Management). Para el profesional de la gestión, riesgo es el &quot;efecto que la incertidumbre tiene sobre la consecución de los objetivos de negocio&quot;. En otras palabras, es una amenaza y es negativo.</code></pre>
<p>O, esta otra, del Open Group</p>
<pre><code>Manejo de riesgo técnico en el estándar de TOGAF que se enfoca principalmente en los riesgos presentados en los proyectos de arquitectura (Open Group, Risk Management).</code></pre>
<p>Vemos que para esta organización especializada el riesgo técnico de arquitectura es aquel que tiene que ver con los procyetos de arquitectura, diferente de otros enunciados, como el de la ERM (Enterprise Risk Management), que es más amplia y que se extiende hasta negocio, sistemas de información, privacidad, normatividad, cambio, ente otras.</p>
<p>En este proyecto, y en el mismo sentido de la definición de riesgo técnico de ambas definiciones (ERM y Open Group), por su relación con las arquitecturas del FNA, acogemos parte de esta definición y la acotamos necesariamente al tratar únicamente sobre los <em>riesgos tecnológicos que amenazan (afectan) a las arquitecturas SOA y a la consecución de objetivos de la Oficina de Arquitectura del FNA</em>.</p>
<pre><code>Por tanto, en este proyecto definimos, y trataremos sobre, el riesgo técnico como aquellos que afectan a los objetivos de la Oficina de Arquitectura, a la tecnología, al software y a los servicios SOA del FNA, que se identifiquen dentro del ejercicio del flujo de trabajo de dicha oficina y en los proyectos de arquitectura que sus involucrados ejecuten.</code></pre>
<p>Desde aquí consideramos el concepto de riesgo técnico de arquitectura FNA que se dan por las decisiones de diseño, selección y migración de tecnología, transición de arquitecturas, alineación funcional, sobrecosto de inversión TI, complejidad de la implementación, entre otros. <em>Es intencional que al hacer foco en el tratamiento a estos aspectos de riesgos de las arquitecturas del FNA la utilidad, calidad y efectividad del repositorio de arquitectura, y la misma arquitectura del FNA mejorará</em> y su valor será evidente.</p>
<h1 id="antecedentes-de-riesgo-técnico-de-arquitectura-fna">Antecedentes de Riesgo Técnico de Arquitectura FNA</h1>
<p>Para elaborar los antecedentes de los riesgos técnicos de arquitectura del FNA, sujetos del gobierno de este proyecto, tomaremos como base los análisis previamente realizados en el FNA durante la fase anterior de esta consultoría.</p>
<h2 id="identificación-de-riesgos-técnicos-del-fna">Identificación de Riesgos Técnicos del FNA</h2>
<p>Junto a esta complicación, que de por sí hace obligatoria la introducción de la figura del gobierno SOA en el Fondo, y que organizaciones como el OpenGroup señalan que se dan por la falta de Arquitectura SOA y Arquitectura Empresarial, y por consiguiente, por un débil gobierno SOA, se encuentran otras que fueron levantadas en la Fase 1 del presente diagnóstico: agilidad limitada, complejidad e imprecisión en la trazabilidad, ocultamiento de funcionalidades (ver <a href="N03a%a20Vsta%20aSegenta%20SOA%20FNA.md">04b.Resumen Fase 1</a>).</p>
<p>Los análisis siguientes dan cuenta de los riesgos técnicos hallados en Fase I.</p>
<ol type="1">
<li>Análisis de Madurez SOA del FNA (OSIMM, Open Group; E-Service, Fase I, 2022)</li>
<li>Análisis de Fortalezas/Debilidades SOA del FNA (SOA Patterns, Enterprise Integration Patterns; E-Service, Fase I, 2022)</li>
<li>Oportunidades Relevantes SOA del FNA (BPTrends; E-Service, Fase I, 2022)</li>
<li>Conclusiones Relevantes del Diagnóstico SOA del FNA (E-Service, Fase I, 2022)</li>
</ol>
<p><br></p>
<p>De los análisis nombrados extraemos siete áreas de riesgo técnico de arquitectura a considerar como antecedentes del riesgo en este proyecto. El gobierno SOA del FNA debe contar con las capacidades, recursos y roles, funciones y procedimientos para medir y gestionar los riesgos que de estas provengan y que lo están afectando.</p>
<ul>
<li>R1. Riesgo de agilidad limitada (ver imagen 1)</li>
<li>R2. Riesgo de baja orquestación SOA (ver imagen 2a y 2b)</li>
<li>R3. Riesgo de crecimiento de dependencias entre servicios SOA</li>
<li>R4. Riesgo de crecimiento de adaptadores particulares –opuesto al estándar</li>
<li>R5. Riesgo de baja reutilización de servicios SOA</li>
<li>R6. Riesgo de permanencia de silos (islas) de servicios SOA y aplicaciones</li>
<li>R7. Riesgo de falta de trazabilidad para la evolución e implementación de los servicios SOA</li>
</ul>
<p><br></p>
<p>Mostraremos a continuación la relación causal de estas áreas con los problemáticas encontradas en dichos diagnósticos.</p>
<table>
<colgroup>
<col style="width: 94%" />
<col style="width: 5%" />
</colgroup>
<thead>
<tr class="header">
<th>Diagnóstico FNA</th>
<th>Área de Riesgo/Riesgo Arquitectura</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>FNA realiza soluciones de herramientas de software y servicios SOA a la medida para responder a las necesidades y requerimientos de información de las áreas funcionales, en particular la vicepresidencia de Crédito y la de Operaciones (segmento de la empresa objeto de este diagnóstico). El peligro con esto es que hace a la operación (creación, uso y mantenimiento) y a la gestión, entendida como mejora, explotación y distribución de los datos proclive a la proliferación de silos de datos.</td>
<td>R6, R7</td>
</tr>
<tr class="even">
<td>El análisis del repositorio SOA del FNA evidencia que existen modelos de datos independientes para las diferentes aplicaciones. Por lo tanto, <em>no existe un modelo de datos común (modelo de datos canónico) en la organización</em>. Así mismo, existen inconvenientes en la gestión del ciclo de vida del dato debido a la relación de dependencia con el proveedor Cobiscorp, el ERP del FNA, que dificultan incluir reglas de negocio o nuevas entidades de datos.</td>
<td>R1, R6, R7</td>
</tr>
<tr class="odd">
<td>Desde la perspectiva de madurez SOA, la primera iteración del proceso de evaluación de madurez SOA del FNA determina que <em>FNA es una empresa reactiva</em>, resultado además que es consistente con las otras dimensiones de OSIMM diagnosticadas (negocio, aplicaciones, gobierno, etc.).</td>
<td>R1, R2</td>
</tr>
<tr class="even">
<td>Mejorar los indicadores de eficacia y madurez SOA, como el de soporte y flexibilidad de negocio, el de diseño de soluciones, servicios y aplicaciones, gestionar los cambios desde arquitectura, mejorar los problemas de uso y gestión de la información e infraestructura. Niveles bajos causados principalmente por (1.) El bajo grado de independencia de proveedor: (ver imagen abajo) <em>38 puntos / 100 puntos</em> (2.) Baja flexibilidad y tiempos de entrega (time-to-market): <em>20 / 100 puntos</em>.</td>
<td>R1, R3, R4, R5</td>
</tr>
<tr class="odd">
<td>El futuro gobierno SOA, en conjunto con el plan de la Dirección de Tecnología del FNA, y el próximo plan estratégico (febrero del 2023) debe procurar la ejecución y los recursos necesarios para la realización de estas iteraciones que tienen por objeto profundizar la adopción SOA del Fondo hasta llevarla al siguiente estadio: superar los 50 puntos de madurez SOA.</td>
<td>R1, R7</td>
</tr>
<tr class="even">
<td>El gobierno SOA debe aumentar el índice de independencia de proveedor del Fondo. El resultado interno (ver imagen abajo) en la dimensión de Gobierno obtuvo el puntaje más bajo en este análisis: <em>35 / 100 puntos</em> (los otros análisis, flexibilidad y fortaleza SOA, en esta misma dimensión, obtuvieron en promedio 40 puntos).</td>
<td>R1, R3, R4</td>
</tr>
</tbody>
</table>
<h2 id="hallazgos-en-le-identificación-de-riesgos-técnicos-del-fna">Hallazgos en le Identificación de Riesgos Técnicos del FNA</h2>
<p>En esta parte ejemplificaremos con diagramas y modelos aquellas áreas sensibles de tratamiento de riesgo que nombramos en los temas anteriores y que tienen como base el diagnóstco SOA de Fase 1 (ver <a href="N03a%a20Vsta%20aSegenta%20SOA%20FNA.md">03.Fase 1 PR3 Resultado Diagnóstico Situación Actual</a>). Estas áreas de riesgo serán incorporados a las vigilancias del gobierno SOA propuesto, objeto de este proyecto. A la vez, los riesgos derivados de estas deben ser agregados a la matriz de gestión actual del Fondo, y gestionados por los métodos propios con los que ya cuenta el FNA.</p>
<figure>
<img src="images/ESB-IBM.png" alt="Riesgo no. 1 y 2. Agilidad limitada por la proliferación de la copmlejidad en los servicios SOA del Fondo." />
<figcaption aria-hidden="true">Riesgo no. 1 y 2. Agilidad limitada por la proliferación de la copmlejidad en los servicios SOA del Fondo.</figcaption>
</figure>
<p><em>Fuente: elaboración propia, ae_fna_as_is.archimate.</em></p>
<p><br></p>
<figure>
<img src="images/esb-procesos.png" alt="Riesgo no. 2 (A). En el modelo “ae_fna_as_is.archimate” de situación actual del FNA no aparecen relaciones del bus empresarial (ESB-IBM, en la imagen) con los procesos de negocio. La principal utilización del bus está destinada a la integración entre aplicaciones." />
<figcaption aria-hidden="true">Riesgo no. 2 (A). En el modelo “ae_fna_as_is.archimate” de situación actual del FNA no aparecen relaciones del bus empresarial (ESB-IBM, en la imagen) con los procesos de negocio. La principal utilización del bus está destinada a la integración entre aplicaciones.</figcaption>
</figure>
<p><em>Fuente: ae_fna_as_is.archimate.</em></p>
<p><br></p>
<figure>
<img src="images/ESB-IBM-2.png" alt="Riesgo no. 2 (B). En el modelo “ae_fna_as_is.archimate” no es posible encontrar relaciones del bus con los procesos." />
<figcaption aria-hidden="true">Riesgo no. 2 (B). En el modelo “ae_fna_as_is.archimate” no es posible encontrar relaciones del bus con los procesos.</figcaption>
</figure>
<p><em>Fuente: ae_fna_as_is.archimate.</em></p>
<p><br></p>
<figure>
<img src="images/CRM.png" alt="Riesgo no. 4 y 5. Caso de CRM del FNA. Le afecta el riesgo de estándarización en la interoperabilidad. La desnormalización de la integración aumenta la cantidad de adaptadores particulares." />
<figcaption aria-hidden="true">Riesgo no. 4 y 5. Caso de CRM del FNA. Le afecta el riesgo de estándarización en la interoperabilidad. La desnormalización de la integración aumenta la cantidad de adaptadores particulares.</figcaption>
</figure>
<p><em>Fuente: ae_fna_as_is.archimate.</em></p>
<table>
<colgroup>
<col style="width: 23%" />
<col style="width: 76%" />
</colgroup>
<thead>
<tr class="header">
<th>Tema</th>
<th>Gobierno SOA: <strong>Métodos para el tratamiento de los riesgos técnicos</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Palabras clave</td>
<td>SOA, Gobierno, Riesgo, Objetivos de negocio</td>
</tr>
<tr class="even">
<td>Autor</td>
<td></td>
</tr>
<tr class="odd">
<td>Fuente</td>
<td></td>
</tr>
<tr class="even">
<td>Versión</td>
<td><strong>8f72adc</strong> del 31 Jul 2023</td>
</tr>
<tr class="odd">
<td>Vínculos</td>
<td><a href="N03a%a20Vsta%20aSegenta%20SOA%20FNA.md">Fase 2 PR6 Gobierno SOA</a></td>
</tr>
</tbody>
</table>
<p><br></p>
<h1 id="tratamiento-de-los-riesgos-de-arquitectura-del-fna">Tratamiento de los Riesgos de Arquitectura del FNA</h1>
<p>Organizados como estamos bajo la definición de riesgo de arquitectura adoptada en este proyecto, que en resumen establece que el riesgo de arquitectura es una amenaza, vulnerabilidad e impacto negativo a los objetivos y al trabajo de la Oficina de Arquitectura del FNA, y con los objetivos de Gobierno SOA 0.6 del FNA, dotaremos al modelo de gobierno, versión 0.5, de las capacidades, recursos y roles, funciones y procedimientos para medir y gestionar los riesgos.</p>
<h2 id="gobierno-soa-del-fna-con-gestión-de-riesgos-de-arquitectura-versión-0.6">Gobierno SOA del FNA con Gestión de Riesgos de Arquitectura (versión 0.6)</h2>
<p>La versión 0.6 del Gobierno realizará el tratamiento de las áreas de riesgo R1 a R7 sumando la capacidad de registro de riesgos del repositorio de arquitectura (Gestor de riesgo, en la gráfica).</p>
<div id="fig:9caf1231-13c4-4e5c-af8e-2e543b55629f" class="fignos">
<figure>
<img src="images/modelogob06.png" alt="Imagen 11: Modelo de gobierno SOA del FNA, versión 0.6. Incorpora las actividades de gestión de riesgo, y las capacidades del repositorio de arquitectura." />
<figcaption aria-hidden="true"><span>Imagen 11:</span> Modelo de gobierno SOA del FNA, versión 0.6. Incorpora las actividades de gestión de riesgo, y las capacidades del repositorio de arquitectura.</figcaption>
</figure>
</div>
<p><em>Fuente: elaboración propia.</em></p>
<p><br></p>
<p>El modelo de gobierno 0.6 agrega además al repositorio de análisis los pertinentes a la gestión de riesgos del FNA:</p>
<ol type="1">
<li>Relación Área FNA - Riesgo</li>
<li>Valoración del riesgo</li>
<li>Relación Arquitectura FNA - Riesgo</li>
</ol>
<p><br></p>
<h2 id="oficina-de-arquitectura-con-gestión-de-riesgos">Oficina de Arquitectura con Gestión de Riesgos</h2>
<p>Al igual que hicimos con el gobierno SOA, que al incorporar la gestión de riesgos pasa a ser versión 0.6, ahora haremos lo propio para la Oficina de Arquitectura del FNA. Debemos dotar al flujo de trabajo de esta con las capacidades, recursos y roles, funciones y procedimientos para medir y gestionar los riesgos.</p>
<div id="fig:f33c6a47-dd64-456d-90c5-14e75d8fb5b4" class="fignos">
<figure>
<img src="images/oficinamodelo06.png" alt="Imagen 12: Modelo de Gobierno SOA. Adaptación FNA. Recursos y Herramientas de Gestión del Riesgo de Arquitectura del FNA." />
<figcaption aria-hidden="true"><span>Imagen 12:</span> Modelo de Gobierno SOA. Adaptación FNA. Recursos y Herramientas de Gestión del Riesgo de Arquitectura del FNA.</figcaption>
</figure>
</div>
<p><br></p>
<p>El modelo de colaboración muestra cómo la Oficina y el Gobierno 0.6 se relacionan mutuamente mediante los conceptos y artefactos que son dictados por el gobierno y ejecutados por la oficina de arquitectura (versión 0.1). Estos ítems de colaboración se listan en la columna del centro del diagrama, y <em>son la base fundacional del tratamiento de los riesgos</em> técnicos de arquitectura con los que complementan además y mejoran al gobierno del FNA.</p>
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 79%" />
</colgroup>
<thead>
<tr class="header">
<th>Tema</th>
<th>Gobierno SOA del FNA: <strong>Modelamiento del Riesgo Técnico de Arquitectura del FNA</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Palabras clave</td>
<td>SOA, Riesgo técnico, Modelo, Arquitectura</td>
</tr>
<tr class="even">
<td>Autor</td>
<td></td>
</tr>
<tr class="odd">
<td>Fuente</td>
<td></td>
</tr>
<tr class="even">
<td>Versión</td>
<td><strong>1.8f72adc</strong> del 31 Jul 2023</td>
</tr>
<tr class="odd">
<td>Vínculos</td>
<td><a href="onenote:#N001d.sharepoint.com">Ejecución Plan de Trabajo SOA</a>; <a href="onenote:#N003a.com">Procesos de Negocio FNA</a></td>
</tr>
</tbody>
</table>
<p><br></p>
<h1 id="técnica-para-modelar-riesgos-de-arquitectura-para-el-fna">Técnica para Modelar Riesgos de Arquitectura para el FNA</h1>
<p>Para completar el cumplimiento del objetivo de manejo de riesgos del Gobierno SOA del FNA, versión 0.6, y de dotar a la oficina de arquitectura de los recursos para cumplir tal objetivo, desarrollamos a continuación las consideraciones para modelar en el repositorio de arquitectura los riesgos de la arquitectura, lo cual contribuye de gran manera a la gestión y tratamiento de los mismos.</p>
<h2 id="correspondencia-de-conceptos-del-riesgo-y-arquitectura">Correspondencia de Conceptos del Riesgo y Arquitectura</h2>
<p>Es fundamental establecer una correspondencia de conceptos con el “mundo” y el lenguaje de modelado, que en el caso de la arquitectura es ArchiMate 2.1 (o superior). La siguiente tabla presenta una posible correspondencia entre los conceptos del riesgo técnico de la arquitectura y el lenguaje indicado.</p>
<p><br></p>
<div id="tbl:riesgo1-id" class="tablenos">
<table id="tbl:riesgo1-id">
<caption><span>Tabla 2:</span> Correspondencia de Conceptos del Riesgo del Gobierno SOA del FNA, versión 0.6. </caption>
<thead>
<tr class="header">
<th>Correspondencia</th>
<th>Concepto real</th>
<th>Concepto Archimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.</td>
<td>Riesgo</td>
<td>Outcome</td>
</tr>
<tr class="even">
<td>2.</td>
<td>Amenaza</td>
<td>Assessment</td>
</tr>
<tr class="odd">
<td>3.</td>
<td>Vulnerabilidad</td>
<td>Assessment</td>
</tr>
<tr class="even">
<td>4.</td>
<td>Impacto</td>
<td>Outcome</td>
</tr>
<tr class="odd">
<td>5.</td>
<td>Activo / ítem</td>
<td>Resource, Core Element</td>
</tr>
<tr class="even">
<td>6.</td>
<td>Agente riesgo</td>
<td>Active Structure Element</td>
</tr>
<tr class="odd">
<td>7.</td>
<td>Evento riesgoso</td>
<td>Business Event</td>
</tr>
<tr class="even">
<td>8.</td>
<td>Securidad.Meta</td>
<td>Goal</td>
</tr>
<tr class="odd">
<td>9.</td>
<td>Securidad.Resultado</td>
<td>Outcome</td>
</tr>
<tr class="even">
<td>10.</td>
<td>Securidad.Principio</td>
<td>Principle</td>
</tr>
<tr class="odd">
<td>11.</td>
<td>Securidad.Requerimiento</td>
<td>Requirement</td>
</tr>
<tr class="even">
<td>12.</td>
<td>Securidad.Cumplimiento</td>
<td>Requirement</td>
</tr>
<tr class="odd">
<td>13.</td>
<td>Securidad.Control</td>
<td>Requirement</td>
</tr>
<tr class="even">
<td>14.</td>
<td>Securidad.Measure</td>
<td>Requirement</td>
</tr>
<tr class="odd">
<td>15.</td>
<td>Securidad.Constraint</td>
<td>Constraint</td>
</tr>
<tr class="even">
<td>16.</td>
<td>Riesgo.auditor</td>
<td>Stakeholder</td>
</tr>
<tr class="odd">
<td>17.</td>
<td>Riesgo.analista</td>
<td>Stakeholder</td>
</tr>
<tr class="even">
<td>18.</td>
<td>Riesgo.asesor</td>
<td>Stakeholder</td>
</tr>
<tr class="odd">
<td>19.</td>
<td>Security Resource</td>
<td>Architect</td>
</tr>
<tr class="even">
<td>20.</td>
<td>Security Service</td>
<td>Capability</td>
</tr>
<tr class="odd">
<td>21.</td>
<td>Security Capability</td>
<td>Service</td>
</tr>
</tbody>
</table>
</div>
<p><br></p>
<p>En los siguientes contenidos describiremos las técnicas para el uso de los conceptos de ArchiMate que resulten en el modelamiento y la documentación generada de los riesgos, tal que contribuyan a la gestión de los riesgos, y que contribuyan al Gobierno SOA, versión 0.6, del FNA.</p>
<h2 id="referencia-para-modelar-el-riesgo-de-arquitectura-del-fna">Referencia para Modelar el Riesgo de Arquitectura del FNA</h2>
<p>La idea central del modelamiento de los riesgos de arquitectura es darles alguna respuesta a las siguientes preguntas de control respecto a cada eventos de riesgo o amenaza que problematice las funciones de la Oficina de Arquitectura del FNA.</p>
<p>Ante un evento riesgoso o amenaza el modelo busca responder las siguientes preguntas de control.</p>
<ol type="1">
<li>¿Qué puede salir mal en la operación existente?</li>
<li>¿Qué hacer para darle tratamiento a esta amenaza?</li>
<li>¿Qué activos/ítems o sistemas debemos proteger?</li>
<li>¿Qué sistema (aplicación, sistema o componente) será impactado, y en qué medida?</li>
</ol>
<p><br></p>
<p>A continuación, presentamos la propuesta de uso y organización de los conceptos generales para el modelamiento de los riesgos de arquitectura del FNA.</p>
<div id="fig:7a9bee97-877f-44ce-9b25-1f4f4422d22e" class="fignos">
<figure>
<img src="images/modeloriesgo.png" alt="Imagen 13: Modelo de ejemplo para la representación de los artefactos, recursos, actividades y activos (software) afectados." />
<figcaption aria-hidden="true"><span>Imagen 13:</span> Modelo de ejemplo para la representación de los artefactos, recursos, actividades y activos (software) afectados.</figcaption>
</figure>
</div>
<p><em>Fuente: elaboración propia.</em></p>
<p><br></p>
<p>Podemos comprobar la efectividad del modelo de riesgo relacionándolo con las preguntas de control consignadas arriba. En la siguiente ilustración mostramos cómo el modelo responde a estas preguntas.</p>
<div id="fig:7c01668b-41ca-4264-aca3-747ea1b34d29" class="fignos">
<figure>
<img src="images/modeloriesgo1a.png" alt="Imagen 14: Relación de los conceptos del modelo de riesgo con las preguntas de control del tratamiento de riesgos de arquitectura del FNA." />
<figcaption aria-hidden="true"><span>Imagen 14:</span> Relación de los conceptos del modelo de riesgo con las preguntas de control del tratamiento de riesgos de arquitectura del FNA.</figcaption>
</figure>
</div>
<p><em>Fuente: Diagnóstico SOA. E-Service (2022).</em></p>
<p><br></p>
<pre><code>Importante: Para todos los riesgos, la herramienta de implementación del repositorio de arquitectura del FNA (que para el proyecto es Mega) debe tener la capacidad de generar la documentación técnica del riesgo a partir de su modelo. </code></pre>
<h2 id="modelo-simple-de-riesgo-de-arquitectura">Modelo Simple de Riesgo de Arquitectura</h2>
<p>Desarrollamos un modelo de riesgo tomando como entrada un caso particular del FNA descrito anteriormente.</p>
<div id="fig:96707782-6136-4571-aa89-8f8dd7a59b09" class="fignos">
<figure>
<img src="images/modeloriesgo001.png" alt="Imagen 15: Modelo de ejemplo para la representación de los artefactos, recursos, actividades y activos (software) afectados." />
<figcaption aria-hidden="true"><span>Imagen 15:</span> Modelo de ejemplo para la representación de los artefactos, recursos, actividades y activos (software) afectados.</figcaption>
</figure>
</div>
<p><em>Fuente: elaboración propia.</em></p>
<p><br></p>
<p>Para la identificación y trazabilidad del estado de un riesgo necesitamos etiquetar con una identificación única a cada riesgo gestionado. En el modelo que presentamos el identificador es el 001.</p>
<pre><code>Importante: Para todos los riesgos, la herramienta de implementación del repositorio de arquitectura del FNA (que para el proyecto es Mega) debe tener la capacidad de generar la documentación técnica del riesgo a partir de su modelo. </code></pre>
<p><br></p>
<div style="page-break-before: always;">

</div>
<h1 class="page_break_before" id="referencias">Referencias</h1>
<!-- Explicitly insert bibliography here -->
<div id="refs" role="doc-bibliography">
<ul>
<li>E-Service. Situación SOA Actual del FNA. Etapa I. (2022).</li>
<li>E-Service. Arquitectura de Referencia del FNA. Etapa II. (2023).</li>
<li>E-Service. Hoja de Ruta e Iniciativas. Etapa III. (2023).</li>
<li>TOGAF 9.1. Risk Management (2023). En https://pubs.opengroup.org/architecture/togaf9-doc/arch/chap27.html</li>
<li>Software Architecture Evaluation Methods – A survey. P. Shanmugapriya, Research Scholar, Department of CSE, SCSVMV University, Enathur, Tamilnadu,INDIA</li>
</ul>
</div>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>Software Architecture Evaluation Methods – A survey. P. Shanmugapriya, Research Scholar, Department of CSE, SCSVMV University, Enathur, Tamilnadu, INDIA<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!-- default theme -->

<style>
  /* import google fonts */
  @import url("https://fonts.googleapis.com/css?family=Open+Sans:400,600,700");
  @import url("https://fonts.googleapis.com/css?family=Source+Code+Pro");

  /* -------------------------------------------------- */
  /* global */
  /* -------------------------------------------------- */

  /* all elements */
  * {
    /* force sans-serif font unless specified otherwise */
    font-family: "Open Sans", "Helvetica", sans-serif;

    /* prevent text inflation on some mobile browsers */
    -webkit-text-size-adjust: none !important;
    -moz-text-size-adjust: none !important;
    -o-text-size-adjust: none !important;
    text-size-adjust: none !important;
  }

  @media only screen {
    /* "page" element */
    body {
      position: relative;
      box-sizing: border-box;
      font-size: 12pt;
      line-height: 1.5;
      max-width: 8.5in;
      margin: 20px auto;
      padding: 40px;
      border-radius: 5px;
      border: solid 1px #bdbdbd;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
      background: #ffffff;
    }
  }

  /* when on screen < 8.5in wide */
  @media only screen and (max-width: 8.5in) {
    /* "page" element */
    body {
      padding: 20px;
      margin: 0;
      border-radius: 0;
      border: none;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.05) inset;
      background: none;
    }
  }

  /* -------------------------------------------------- */
  /* headings */
  /* -------------------------------------------------- */

  /* all headings */
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    margin: 20px 0;
    padding: 0;
    font-weight: bold;
  }

  /* biggest heading */
  h1 {
    margin: 40px 0;
    text-align: center;
  }

  /* second biggest heading */
  h2 {
    margin-top: 30px;
    padding-bottom: 5px;
    border-bottom: solid 1px #bdbdbd;
  }

  /* heading font sizes */
  h1 {
    font-size: 2em;
  }
  h2 {
    font-size: 1.5em;
  }
  h3 {
    font-size: 1.35em;
  }
  h4 {
    font-size: 1.25em;
  }
  h5 {
    font-size: 1.15em;
  }
  h6 {
    font-size: 1em;
  }

  /* -------------------------------------------------- */
  /* manuscript header */
  /* -------------------------------------------------- */

  /* manuscript title */
  header > h1 {
    margin: 0;
  }

  /* manuscript title caption text (ie "automatically generated on") */
  header + p {
    text-align: center;
    margin-top: 10px;
  }

  /* -------------------------------------------------- */
  /* text elements */
  /* -------------------------------------------------- */

  /* links */
  a {
    color: #2196f3;
    overflow-wrap: break-word;
  }

  /* superscripts and subscripts */
  sub,
  sup {
    /* prevent from affecting line height */
    line-height: 0;
  }

  /* unordered and ordered lists*/
  ul,
  ol {
    padding-left: 20px;
  }

  /* class for styling text semibold */
  .semibold {
    font-weight: 600;
  }

  /* class for styling elements horizontally left aligned */
  .left {
    display: block;
    text-align: left;
    margin-left: auto;
    margin-right: 0;
    justify-content: left;
  }

  /* class for styling elements horizontally centered */
  .center {
    display: block;
    text-align: center;
    margin-left: auto;
    margin-right: auto;
    justify-content: center;
  }

  /* class for styling elements horizontally right aligned */
  .right {
    display: block;
    text-align: right;
    margin-left: 0;
    margin-right: auto;
    justify-content: right;
  }

  /* -------------------------------------------------- */
  /* section elements */
  /* -------------------------------------------------- */

  /* horizontal divider line */
  hr {
    border: none;
    height: 1px;
    background: #bdbdbd;
  }

  /* paragraphs, horizontal dividers, figures, tables, code */
  p,
  hr,
  figure,
  table,
  pre {
    /* treat all as "paragraphs", with consistent vertical margins */
    margin-top: 20px;
    margin-bottom: 20px;
  }

  /* -------------------------------------------------- */
  /* figures */
  /* -------------------------------------------------- */

  /* figure */
  figure {
    max-width: 100%;
    margin-left: auto;
    margin-right: auto;
  }

  /* figure caption */
  figcaption {
    padding: 0;
    padding-top: 10px;
  }

  /* figure image element */
  figure > img,
  figure > svg {
    max-width: 100%;
    display: block;
    margin-left: auto;
    margin-right: auto;
  }

  /* figure auto-number */
  img + figcaption > span:first-of-type,
  svg + figcaption > span:first-of-type {
    font-weight: bold;
    margin-right: 5px;
  }

  /* -------------------------------------------------- */
  /* tables */
  /* -------------------------------------------------- */

  /* table */
  table {
    border-collapse: collapse;
    border-spacing: 0;
    width: 100%;
    margin-left: auto;
    margin-right: auto;
  }

  /* table cells */
  th,
  td {
    border: solid 1px #bdbdbd;
    padding: 10px;
    /* squash table if too wide for page by forcing line breaks */
    overflow-wrap: break-word;
    word-break: break-word;
  }

  /* header row and even rows */
  th,
  tr:nth-child(2n) {
    background-color: #fafafa;
  }

  /* odd rows */
  tr:nth-child(2n + 1) {
    background-color: #ffffff;
  }

  /* table caption */
  caption {
    text-align: left;
    padding: 0;
    padding-bottom: 10px;
  }

  /* table auto-number */
  table > caption > span:first-of-type {
    font-weight: bold;
    margin-right: 5px;
  }

  /* -------------------------------------------------- */
  /* code */
  /* -------------------------------------------------- */

  /* multi-line code block */
  pre {
    padding: 10px;
    background-color: #eeeeee;
    color: #000000;
    border-radius: 5px;
    break-inside: avoid;
    text-align: left;
  }

  /* inline code, ie code within normal text */
  :not(pre) > code {
    padding: 0 4px;
    background-color: #eeeeee;
    color: #000000;
    border-radius: 5px;
  }

  /* code text */
  /* apply all children, to reach syntax highlighting sub-elements */
  code,
  code * {
    /* force monospace font */
    font-family: "Source Code Pro", "Courier New", monospace;
  }

  /* -------------------------------------------------- */
  /* quotes */
  /* -------------------------------------------------- */

  /* quoted text */
  blockquote {
    margin: 0;
    padding: 0;
    border-left: 4px solid #bdbdbd;
    padding-left: 16px;
    break-inside: avoid;
  }

  /* -------------------------------------------------- */
  /* banners */
  /* -------------------------------------------------- */

  /* info banners */
  .banner {
    box-sizing: border-box;
    display: block;
    position: relative;
    width: 100%;
    margin-top: 20px;
    margin-bottom: 20px;
    padding: 20px;
    text-align: center;
  }

  /* paragraph in banner */
  .banner > p {
    margin: 0;
  }

  /* -------------------------------------------------- */
  /* highlight colors */
  /* -------------------------------------------------- */

  .white {
    background: #ffffff;
  }
  .lightgrey {
    background: #eeeeee;
  }
  .grey {
    background: #757575;
  }
  .darkgrey {
    background: #424242;
  }
  .black {
    background: #000000;
  }
  .lightred {
    background: #ffcdd2;
  }
  .lightyellow {
    background: #ffecb3;
  }
  .lightgreen {
    background: #dcedc8;
  }
  .lightblue {
    background: #e3f2fd;
  }
  .lightpurple {
    background: #f3e5f5;
  }
  .red {
    background: #f44336;
  }
  .orange {
    background: #ff9800;
  }
  .yellow {
    background: #ffeb3b;
  }
  .green {
    background: #4caf50;
  }
  .blue {
    background: #2196f3;
  }
  .purple {
    background: #9c27b0;
  }
  .white,
  .lightgrey,
  .lightred,
  .lightyellow,
  .lightgreen,
  .lightblue,
  .lightpurple,
  .orange,
  .yellow,
  .white a,
  .lightgrey a,
  .lightred a,
  .lightyellow a,
  .lightgreen a,
  .lightblue a,
  .lightpurple a,
  .orange a,
  .yellow a {
    color: #000000;
  }
  .grey,
  .darkgrey,
  .black,
  .red,
  .green,
  .blue,
  .purple,
  .grey a,
  .darkgrey a,
  .black a,
  .red a,
  .green a,
  .blue a,
  .purple a {
    color: #ffffff;
  }

  /* -------------------------------------------------- */
  /* buttons */
  /* -------------------------------------------------- */

  /* class for styling links like buttons */
  .button {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    margin: 5px;
    padding: 10px 20px;
    font-size: 0.75em;
    font-weight: 600;
    text-transform: uppercase;
    text-decoration: none;
    letter-spacing: 1px;
    background: none;
    color: #2196f3;
    border: solid 1px #bdbdbd;
    border-radius: 5px;
  }

  /* buttons when hovered */
  .button:hover:not([disabled]),
  .icon_button:hover:not([disabled]) {
    cursor: pointer;
    background: #f5f5f5;
  }

  /* buttons when disabled */
  .button[disabled],
  .icon_button[disabled] {
    opacity: 0.35;
    pointer-events: none;
  }

  /* class for styling buttons containg only single icon */
  .icon_button {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    text-decoration: none;
    margin: 0;
    padding: 0;
    background: none;
    border-radius: 5px;
    border: none;
    width: 20px;
    height: 20px;
    min-width: 20px;
    min-height: 20px;
  }

  /* icon button inner svg image */
  .icon_button > svg {
    height: 16px;
  }

  /* -------------------------------------------------- */
  /* icons */
  /* -------------------------------------------------- */

  /* class for styling icons inline with text */
  .inline_icon {
    height: 1em;
    position: relative;
    top: 0.125em;
  }

  /* -------------------------------------------------- */
  /* references */
  /* -------------------------------------------------- */

  .csl-entry {
    margin-top: 15px;
    margin-bottom: 15px;
  }

  /* -------------------------------------------------- */
  /* print control */
  /* -------------------------------------------------- */

  @media print {
    @page {
      /* suggested printing margin */
      margin: 0.5in;
    }

    /* document and "page" elements */
    html,
    body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
    }

    /* "page" element */
    body {
      font-size: 11pt !important;
      line-height: 1.35;
    }

    /* all headings */
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      margin: 15px 0;
    }

    /* figures and tables */
    figure,
    table {
      font-size: 0.85em;
    }

    /* table cells */
    th,
    td {
      padding: 5px;
    }

    /* shrink font awesome icons */
    i.fas,
    i.fab,
    i.far,
    i.fal {
      transform: scale(0.85);
    }

    /* decrease banner margins */
    .banner {
      margin-top: 15px;
      margin-bottom: 15px;
      padding: 15px;
    }

    /* class for centering an element vertically on its own page */
    .page_center {
      margin: auto;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      vertical-align: middle;
      break-before: page;
      break-after: page;
    }

    /* always insert a page break before the element */
    .page_break_before {
      break-before: page;
    }

    /* always insert a page break after the element */
    .page_break_after {
      break-after: page;
    }

    /* avoid page break before the element */
    .page_break_before_avoid {
      break-before: avoid;
    }

    /* avoid page break after the element */
    .page_break_after_avoid {
      break-after: avoid;
    }

    /* avoid page break inside the element */
    .page_break_inside_avoid {
      break-inside: avoid;
    }
  }

  /* -------------------------------------------------- */
  /* override pandoc css quirks */
  /* -------------------------------------------------- */

  .sourceCode {
    /* prevent unsightly overflow in wide code blocks */
    overflow: auto !important;
  }

  div.sourceCode {
    /* prevent background fill on top-most code block  container */
    background: none !important;
  }

  .sourceCode * {
    /* force consistent line spacing */
    line-height: 1.5 !important;
  }

  div.sourceCode {
    /* style code block margins same as <pre> element */
    margin-top: 20px;
    margin-bottom: 20px;
  }

  /* -------------------------------------------------- */
  /* tablenos */
  /* -------------------------------------------------- */

  /* tablenos wrapper */
  .tablenos {
    width: 100%;
    margin: 20px 0;
  }

  .tablenos > table {
    /* move margins from table to table_wrapper to allow margin collapsing */
    margin: 0;
  }

  @media only screen {
    /* tablenos wrapper */
    .tablenos {
      /* show scrollbar on tables if necessary to prevent overflow */
      overflow-x: auto !important;
    }

    .tablenos th,
    .tablenos td {
      overflow-wrap: unset !important;
      word-break: unset !important;
    }

    /* table in wrapper */
    .tablenos table,
    .tablenos table * {
      /* don't break table words */
      overflow-wrap: normal !important;
    }
  }
</style>
<!-- 
    Plugin Core

    Functions needed for and shared across all first-party plugins.
-->

<script>
  // get element that is target of hash (from link element or url)
  function getHashTarget(link) {
    const hash = link ? link.hash : window.location.hash;
    const id = hash.slice(1);
    let target = document.querySelector(`[id="${id}"]`);
    if (!target) return;

    // if figure or table, modify target to get expected element
    if (id.indexOf("fig:") === 0) target = target.querySelector("figure");
    if (id.indexOf("tbl:") === 0) target = target.querySelector("table");

    return target;
  }

  // get position/dimensions of element or viewport
  function getRectInView(element) {
    let rect = {};
    rect.left = 0;
    rect.top = 0;
    rect.right = document.documentElement.clientWidth;
    rect.bottom = document.documentElement.clientHeight;
    let style = {};

    if (element instanceof HTMLElement) {
      rect = element.getBoundingClientRect();
      style = window.getComputedStyle(element);
    }

    const margin = {};
    margin.left = parseFloat(style.marginLeftWidth) || 0;
    margin.top = parseFloat(style.marginTopWidth) || 0;
    margin.right = parseFloat(style.marginRightWidth) || 0;
    margin.bottom = parseFloat(style.marginBottomWidth) || 0;

    const border = {};
    border.left = parseFloat(style.borderLeftWidth) || 0;
    border.top = parseFloat(style.borderTopWidth) || 0;
    border.right = parseFloat(style.borderRightWidth) || 0;
    border.bottom = parseFloat(style.borderBottomWidth) || 0;

    const newRect = {};
    newRect.left = rect.left + margin.left + border.left;
    newRect.top = rect.top + margin.top + border.top;
    newRect.right = rect.right + margin.right + border.right;
    newRect.bottom = rect.bottom + margin.bottom + border.bottom;
    newRect.width = newRect.right - newRect.left;
    newRect.height = newRect.bottom - newRect.top;

    return newRect;
  }

  // get position of element relative to page
  function getRectInPage(element) {
    const rect = getRectInView(element);
    const body = getRectInView(document.body);

    const newRect = {};
    newRect.left = rect.left - body.left;
    newRect.top = rect.top - body.top;
    newRect.right = rect.right - body.left;
    newRect.bottom = rect.bottom - body.top;
    newRect.width = rect.width;
    newRect.height = rect.height;

    return newRect;
  }

  // get closest element before specified element that matches query
  function firstBefore(element, query) {
    while (element && element !== document.body && !element.matches(query))
      element = element.previousElementSibling || element.parentNode;

    return element;
  }

  // check if element is part of collapsed heading
  function isCollapsed(element) {
    while (element && element !== document.body) {
      if (element.dataset.collapsed === "true") return true;
      element = element.parentNode;
    }
    return false;
  }

  // expand any collapsed parent containers of element if necessary
  function expandElement(element) {
    if (isCollapsed(element)) {
      // accordion plugin
      const heading = firstBefore(element, "h2");
      if (heading) heading.click();
      // details/summary HTML element
      const summary = firstBefore(element, "summary");
      if (summary) summary.click();
    }
  }

  // scroll to and focus element
  function goToElement(element, offset) {
    // expand accordion section if collapsed
    expandElement(element);
    const y =
      getRectInView(element).top -
      getRectInView(document.documentElement).top -
      (offset || 0);

    // trigger any function listening for "onscroll" event
    window.dispatchEvent(new Event("scroll"));
    window.scrollTo(0, y);
    document.activeElement.blur();
    element.focus();
  }

  // get list of elements after a start element up to element matching query
  function nextUntil(element, query, exclude) {
    const elements = [];
    while (((element = element.nextElementSibling), element)) {
      if (element.matches(query)) break;
      if (!element.matches(exclude)) elements.push(element);
    }
    return elements;
  }
</script>
<!--
  Accordion Plugin

  Allows sections of content under h2 headings to be collapsible.
-->

<script type="module">
  // whether to always start expanded ('false'), always start collapsed
  // ('true'), or start collapsed when screen small ('auto')
  const startCollapsed = "auto";

  // start script
  function start() {
    // run through each <h2> heading
    const headings = document.querySelectorAll("h2");
    for (const heading of headings) {
      addArrow(heading);

      // start expanded/collapsed based on option
      if (
        startCollapsed === "true" ||
        (startCollapsed === "auto" && isSmallScreen()) ||
        heading.dataset.collapsed === "true"
      )
        collapseHeading(heading);
      else expandElement(heading);
    }

    // attach hash change listener to window
    window.addEventListener("hashchange", onHashChange);
  }

  // when hash (eg manuscript.html#introduction) changes
  function onHashChange() {
    const target = getHashTarget();
    if (target) goToElement(target);
  }

  // add arrow to heading
  function addArrow(heading) {
    // add arrow button
    const arrow = document.createElement("button");
    arrow.innerHTML = document.querySelector(".icon_angle_down").innerHTML;
    arrow.classList.add("icon_button", "accordion_arrow");
    heading.insertBefore(arrow, heading.firstChild);

    // attach click listener to heading and button
    heading.addEventListener("click", onHeadingClick);
    arrow.addEventListener("click", onArrowClick);
  }

  // determine if on mobile-like device with small screen
  function isSmallScreen() {
    return Math.min(window.innerWidth, window.innerHeight) < 480;
  }

  // when <h2> heading is clicked
  function onHeadingClick(event) {
    // only collapse if <h2> itself is target of click (eg, user did
    // not click on anchor within <h2>)
    if (event.target === this) toggleCollapse(this);
  }

  // when arrow button is clicked
  function onArrowClick() {
    toggleCollapse(this.parentNode);
  }

  // collapse section if expanded, expand if collapsed
  function toggleCollapse(heading) {
    if (heading.dataset.collapsed === "false") collapseHeading(heading);
    else expandElement(heading);
  }

  // elements to exclude from collapse, such as table of contents panel,
  // hypothesis panel, etc
  const exclude = "#toc_panel, div.annotator-frame, #lightbox_overlay";

  // collapse section
  function collapseHeading(heading) {
    heading.setAttribute("data-collapsed", "true");
    const children = getChildren(heading);
    for (const child of children) child.setAttribute("data-collapsed", "true");
  }

  // expand section
  function expandElement(heading) {
    heading.setAttribute("data-collapsed", "false");
    const children = getChildren(heading);
    for (const child of children) child.setAttribute("data-collapsed", "false");
  }

  // get list of elements between this <h2> and next <h2> or <h1>
  // ("children" of the <h2> section)
  function getChildren(heading) {
    return nextUntil(heading, "h2, h1", exclude);
  }

  // start script when document is finished loading
  window.addEventListener("load", start);
</script>

<!-- angle down icon -->

<template class="icon_angle_down">
  <!-- modified from: https://fontawesome.com/icons/angle-down -->
  <svg width="16" height="16" viewBox="0 0 448 512">
    <path
      fill="currentColor"
      d="M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"
    ></path>
  </svg>
</template>

<style>
  @media only screen {
    /* accordion arrow button */
    .accordion_arrow {
      margin-right: 10px;
    }

    /* arrow icon when <h2> data-collapsed attribute true */
    h2[data-collapsed="true"] > .accordion_arrow > svg {
      transform: rotate(-90deg);
    }

    /* all elements (except <h2>'s) when data-collapsed attribute true */
    *:not(h2)[data-collapsed="true"] {
      display: none;
    }

    /* accordion arrow button when hovered and <h2>'s when hovered */
    .accordion_arrow:hover,
    h2[data-collapsed="true"]:hover,
    h2[data-collapsed="false"]:hover {
      cursor: pointer;
    }
  }

  /* always hide accordion arrow button on print */
  @media only print {
    .accordion_arrow {
      display: none;
    }
  }
</style>
<!--
  Anchors Plugin

  Adds an anchor next to each of a certain type of element that provides a
  human-readable url to that specific item/position in the document (e.g.
  "manuscript.html#abstract"). It also makes it such that scrolling out of view
  of a target removes its identifier from the url.
-->

<script type="module">
  // which types of elements to add anchors next to, in "document.querySelector"
  // format
  const typesQuery =
    'h1, h2, h3, div[id^="fig:"], div[id^="tbl:"], span[id^="eq:"]';

  // start script
  function start() {
    // add anchor to each element of specified types
    const elements = document.querySelectorAll(typesQuery);
    for (const element of elements) addAnchor(element);

    // attach scroll listener to window
    window.addEventListener("scroll", onScroll);
  }

  // when window is scrolled
  function onScroll() {
    // if url has hash and user has scrolled out of view of hash
    // target, remove hash from url
    const tolerance = 100;
    const target = getHashTarget();
    if (target) {
      if (
        target.getBoundingClientRect().top > window.innerHeight + tolerance ||
        target.getBoundingClientRect().bottom < 0 - tolerance
      )
        history.pushState(null, null, " ");
    }
  }

  // add anchor to element
  function addAnchor(element) {
    let addTo; // element to add anchor button to

    // if figure or table, modify withId and addTo to get expected
    // elements
    if (element.id.indexOf("fig:") === 0) {
      addTo = element.querySelector("figcaption");
    } else if (element.id.indexOf("tbl:") === 0) {
      addTo = element.querySelector("caption");
    } else if (element.id.indexOf("eq:") === 0) {
      addTo = element.querySelector(".eqnos-number");
    }

    addTo = addTo || element;
    const id = element.id || null;

    // do not add anchor if element doesn't have assigned id.
    // id is generated by pandoc and is assumed to be unique and
    // human-readable
    if (!id) return;

    // create anchor button
    const anchor = document.createElement("a");
    anchor.innerHTML = document.querySelector(".icon_link").innerHTML;
    anchor.title = "Link to this part of the document";
    anchor.classList.add("icon_button", "anchor");
    anchor.dataset.ignore = "true";
    anchor.href = "#" + id;
    addTo.appendChild(anchor);
  }

  // start script when document is finished loading
  window.addEventListener("load", start);
</script>

<!-- link icon -->

<template class="icon_link">
  <!-- modified from: https://fontawesome.com/icons/link -->
  <svg width="16" height="16" viewBox="0 0 512 512">
    <path
      fill="currentColor"
      d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"
    ></path>
  </svg>
</template>

<style>
  @media only screen {
    /* anchor button */
    .anchor {
      opacity: 0;
      margin-left: 5px;
    }

    /* anchor buttons within <h2>'s */
    h2 .anchor {
      margin-left: 10px;
    }

    /* anchor buttons when hovered/focused and anything containing an anchor button when hovered */
    *:hover > .anchor,
    .anchor:hover,
    .anchor:focus {
      opacity: 1;
    }

    /* anchor button when hovered */
    .anchor:hover {
      cursor: pointer;
    }
  }

  /* always show anchor button on devices with no mouse/hover ability */
  @media (hover: none) {
    .anchor {
      opacity: 1;
    }
  }

  /* always hide anchor button on print */
  @media only print {
    .anchor {
      display: none;
    }
  }
</style>
<!-- 
    Attributes Plugin

    Allows arbitrary HTML attributes to be attached to (almost) any element.
    Place an HTML comment inside or next to the desired element with the content:
    $attribute="value"
-->

<script type="module">
  // start script
  function start() {
    // get list of comments in document
    const comments = findComments();

    for (const comment of comments)
      if (comment.parentElement)
        addAttributes(comment.parentElement, comment.nodeValue.trim());
  }

  // add html attributes to specified element based on string of
  // html attributes and values
  function addAttributes(element, text) {
    // regex's for finding attribute/value pairs in the format of
    // attribute="value" or attribute='value
    const regex2 = /\$([a-zA-Z\-]+)?=\"(.+?)\"/;
    const regex1 = /\$([a-zA-Z\-]+)?=\'(.+?)\'/;

    // loop through attribute/value pairs
    let match;
    while ((match = text.match(regex2) || text.match(regex1))) {
      // get attribute and value from regex capture groups
      let attribute = match[1];
      let value = match[2];

      // remove from string
      text = text.substring(match.index + match[0].length);

      if (!attribute || !value) break;

      // set attribute of parent element
      try {
        element.setAttribute(attribute, value);
      } catch (error) {
        console.log(error);
      }

      // special case for colspan
      if (attribute === "colspan") removeTableCells(element, value);
    }
  }

  // get list of comment elements in document
  function findComments() {
    const comments = [];

    // iterate over comment nodes in document
    function acceptNode(node) {
      return NodeFilter.FILTER_ACCEPT;
    }
    const iterator = document.createNodeIterator(
      document.body,
      NodeFilter.SHOW_COMMENT,
      acceptNode
    );
    let node;
    while ((node = iterator.nextNode())) comments.push(node);

    return comments;
  }

  // remove certain number of cells after specified cell
  function removeTableCells(cell, number) {
    number = parseInt(number);
    if (!number) return;

    // remove elements
    for (; number > 1; number--) {
      if (cell.nextElementSibling) cell.nextElementSibling.remove();
    }
  }

  // start script on DOMContentLoaded instead of load to ensure this plugins
  // runs before other plugins
  window.addEventListener("DOMContentLoaded", start);
</script>
<!--
  Jump to First Plugin

  Adds a button next to each reference entry, figure, and table that jumps the
  page to the first occurrence of a link to that item in the manuscript.
-->

<script type="module">
  // whether to add buttons next to reference entries
  const references = "true";
  // whether to add buttons next to figures
  const figures = "true";
  // whether to add buttons next to tables
  const tables = "true";

  // start script
  function start() {
    if (references !== "false")
      makeButtons(`div[id^="ref-"]`, ".csl-left-margin", "reference");
    if (figures !== "false")
      makeButtons(`div[id^="fig:"]`, "figcaption", "figure");
    if (tables !== "false") makeButtons(`div[id^="tbl:"]`, "caption", "table");
  }

  // when jump button clicked
  function onButtonClick() {
    const first = getFirstOccurrence(this.dataset.id);
    if (!first) return;

    // update url hash so navigating "back" in history will return user to button
    window.location.hash = this.dataset.id;
    // scroll to link
    const timeout = function () {
      goToElement(first, window.innerHeight * 0.5);
    };
    window.setTimeout(timeout, 0);
  }

  // get first occurrence of link to item in document
  function getFirstOccurrence(id) {
    let query = "a";
    query += '[href="#' + id + '"]';
    // exclude buttons, anchor links, toc links, etc
    query += ":not(.button):not(.icon_button):not(.anchor):not(.toc_link)";
    return document.querySelector(query);
  }

  // add button next to each reference entry, figure, or table
  function makeButtons(query, containerQuery, subject) {
    const elements = document.querySelectorAll(query);
    for (const element of elements) {
      const id = element.id;
      const buttonContainer = element.querySelector(containerQuery);
      const first = getFirstOccurrence(id);

      // if can't find link to reference or place to put button, ignore
      if (!first || !buttonContainer) continue;

      // make jump button
      let button = document.createElement("button");
      button.classList.add("icon_button", "jump_arrow");
      button.title = `Jump to the first occurrence of this ${subject} in the document`;
      const icon = document.querySelector(".icon_angle_double_up");
      button.innerHTML = icon.innerHTML;
      button.dataset.id = id;
      button.dataset.ignore = "true";
      button.addEventListener("click", onButtonClick);
      buttonContainer.prepend(button);
    }
  }

  // start script when document is finished loading
  window.addEventListener("load", start);
</script>

<!-- angle double up icon -->

<template class="icon_angle_double_up">
  <!-- modified from: https://fontawesome.com/icons/angle-double-up -->
  <svg width="16" height="16" viewBox="0 0 320 512">
    <path
      fill="currentColor"
      d="M177 255.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 351.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 425.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1zm-34-192L7 199.7c-9.4 9.4-9.4 24.6 0 33.9l22.6 22.6c9.4 9.4 24.6 9.4 33.9 0l96.4-96.4 96.4 96.4c9.4 9.4 24.6 9.4 33.9 0l22.6-22.6c9.4-9.4 9.4-24.6 0-33.9l-136-136c-9.2-9.4-24.4-9.4-33.8 0z"
    ></path>
  </svg>
</template>

<style>
  @media only screen {
    /* jump button */
    .jump_arrow {
      position: relative;
      top: 0.125em;
      margin-right: 5px;
    }
  }

  /* always hide jump button on print */
  @media only print {
    .jump_arrow {
      display: none;
    }
  }
</style>
<!-- 
    Lightbox Plugin

    Makes it such that when a user clicks on an image, the image fills the
    screen and the user can pan/drag/zoom the image and navigate between other
    images in the document.
-->

<script type="module">
  // list of possible zoom/scale factors
  const zooms =
    "0.1, 0.25, 0.333333, 0.5, 0.666666, 0.75, 1, 1.25, 1.5, 1.75, 2, 2.5, 3, 3.5, 4, 5, 6, 7, 8";
  // whether to fit image to view ('fit'), display at 100% and shrink if
  // necessary ('shrink'), or always display at 100% ('100')
  const defaultZoom = "fit";
  // whether to zoom in/out toward center of view ('true') or mouse ('false')
  const centerZoom = "false";

  // start script
  function start() {
    // run through each <img> element
    const imgs = document.querySelectorAll("figure > img");
    let count = 1;
    for (const img of imgs) {
      img.classList.add("lightbox_document_img");
      img.dataset.number = count;
      img.dataset.total = imgs.length;
      img.addEventListener("click", openLightbox);
      count++;
    }

    // attach mouse and key listeners to window
    window.addEventListener("mousemove", onWindowMouseMove);
    window.addEventListener("keyup", onKeyUp);
  }

  // when mouse is moved anywhere in window
  function onWindowMouseMove(event) {
    window.mouseX = event.clientX;
    window.mouseY = event.clientY;
  }

  // when key pressed
  function onKeyUp(event) {
    if (!event || !event.key) return;

    switch (event.key) {
      // trigger click of prev button
      case "ArrowLeft":
        const prevButton = document.getElementById("lightbox_prev_button");
        if (prevButton) prevButton.click();
        break;
      // trigger click of next button
      case "ArrowRight":
        const nextButton = document.getElementById("lightbox_next_button");
        if (nextButton) nextButton.click();
        break;
      // close on esc
      case "Escape":
        closeLightbox();
        break;
    }
  }

  // open lightbox
  function openLightbox() {
    const lightbox = makeLightbox(this);
    if (!lightbox) return;

    blurBody(lightbox);
    document.body.appendChild(lightbox);
  }

  // make lightbox
  function makeLightbox(img) {
    // delete lightbox if it exists, start fresh
    closeLightbox();

    // create screen overlay containing lightbox
    const overlay = document.createElement("div");
    overlay.id = "lightbox_overlay";

    // create image info boxes
    const numberInfo = document.createElement("div");
    const zoomInfo = document.createElement("div");
    numberInfo.id = "lightbox_number_info";
    zoomInfo.id = "lightbox_zoom_info";

    // create container for image
    const imageContainer = document.createElement("div");
    imageContainer.id = "lightbox_image_container";
    const lightboxImg = makeLightboxImg(
      img,
      imageContainer,
      numberInfo,
      zoomInfo
    );
    imageContainer.appendChild(lightboxImg);

    // create bottom container for caption and navigation buttons
    const bottomContainer = document.createElement("div");
    bottomContainer.id = "lightbox_bottom_container";
    const caption = makeCaption(img);
    const prevButton = makePrevButton(img);
    const nextButton = makeNextButton(img);
    bottomContainer.appendChild(prevButton);
    bottomContainer.appendChild(caption);
    bottomContainer.appendChild(nextButton);

    // attach top middle and bottom to overlay
    overlay.appendChild(numberInfo);
    overlay.appendChild(zoomInfo);
    overlay.appendChild(imageContainer);
    overlay.appendChild(bottomContainer);

    return overlay;
  }

  // make <img> object that is intuitively draggable and zoomable
  function makeLightboxImg(sourceImg, container, numberInfoBox, zoomInfoBox) {
    // create copy of source <img>
    const img = sourceImg.cloneNode(true);
    img.classList.remove("lightbox_document_img");
    img.removeAttribute("id");
    img.removeAttribute("width");
    img.removeAttribute("height");
    img.style.position = "unset";
    img.style.margin = "0";
    img.style.padding = "0";
    img.style.width = "";
    img.style.height = "";
    img.style.minWidth = "";
    img.style.minHeight = "";
    img.style.maxWidth = "";
    img.style.maxHeight = "";
    img.id = "lightbox_img";

    // build sorted list of zoomSteps
    const zoomSteps = zooms.split(/[^0-9.]/).map((step) => parseFloat(step));
    zoomSteps.sort((a, b) => a - b);

    // <img> object property variables
    let zoom = 1;
    let translateX = 0;
    let translateY = 0;
    let clickMouseX = undefined;
    let clickMouseY = undefined;
    let clickTranslateX = undefined;
    let clickTranslateY = undefined;

    updateNumberInfo();

    // update image numbers displayed in info box
    function updateNumberInfo() {
      numberInfoBox.innerHTML =
        sourceImg.dataset.number + " of " + sourceImg.dataset.total;
    }

    // update zoom displayed in info box
    function updateZoomInfo() {
      let zoomInfo = zoom * 100;
      if (!Number.isInteger(zoomInfo)) zoomInfo = zoomInfo.toFixed(2);
      zoomInfoBox.innerHTML = zoomInfo + "%";
    }

    // move to closest zoom step above current zoom
    const zoomIn = function () {
      for (const zoomStep of zoomSteps) {
        if (zoomStep > zoom) {
          zoom = zoomStep;
          break;
        }
      }
      updateTransform();
    };

    // move to closest zoom step above current zoom
    const zoomOut = function () {
      zoomSteps.reverse();
      for (const zoomStep of zoomSteps) {
        if (zoomStep < zoom) {
          zoom = zoomStep;
          break;
        }
      }
      zoomSteps.reverse();

      updateTransform();
    };

    // update display of <img> based on scale/translate properties
    const updateTransform = function () {
      // set transform
      img.style.transform =
        "translate(" +
        (translateX || 0) +
        "px," +
        (translateY || 0) +
        "px) scale(" +
        (zoom || 1) +
        ")";

      // get new width/height after scale
      const rect = img.getBoundingClientRect();
      // limit translate
      translateX = Math.max(translateX, -rect.width / 2);
      translateX = Math.min(translateX, rect.width / 2);
      translateY = Math.max(translateY, -rect.height / 2);
      translateY = Math.min(translateY, rect.height / 2);

      // set transform
      img.style.transform =
        "translate(" +
        (translateX || 0) +
        "px," +
        (translateY || 0) +
        "px) scale(" +
        (zoom || 1) +
        ")";

      updateZoomInfo();
    };

    // fit <img> to container
    const fit = function () {
      // no x/y offset, 100% zoom by default
      translateX = 0;
      translateY = 0;
      zoom = 1;

      // widths of <img> and container
      const imgWidth = img.naturalWidth;
      const imgHeight = img.naturalHeight;
      const containerWidth = parseFloat(
        window.getComputedStyle(container).width
      );
      const containerHeight = parseFloat(
        window.getComputedStyle(container).height
      );

      // how much zooming is needed to fit <img> to container
      const xRatio = imgWidth / containerWidth;
      const yRatio = imgHeight / containerHeight;
      const maxRatio = Math.max(xRatio, yRatio);
      const newZoom = 1 / maxRatio;

      // fit <img> to container according to option
      if (defaultZoom === "shrink") {
        if (maxRatio > 1) zoom = newZoom;
      } else if (defaultZoom === "fit") zoom = newZoom;

      updateTransform();
    };

    // when mouse wheel is rolled anywhere in container
    const onContainerWheel = function (event) {
      if (!event) return;

      // let ctrl + mouse wheel to zoom behave as normal
      if (event.ctrlKey) return;

      // prevent normal scroll behavior
      event.preventDefault();
      event.stopPropagation();

      // point around which to scale img
      const viewRect = container.getBoundingClientRect();
      const viewX = (viewRect.left + viewRect.right) / 2;
      const viewY = (viewRect.top + viewRect.bottom) / 2;
      const originX = centerZoom === "true" ? viewX : mouseX;
      const originY = centerZoom === "true" ? viewY : mouseY;

      // get point on image under origin
      const oldRect = img.getBoundingClientRect();
      const oldPercentX = (originX - oldRect.left) / oldRect.width;
      const oldPercentY = (originY - oldRect.top) / oldRect.height;

      // increment/decrement zoom
      if (event.deltaY < 0) zoomIn();
      if (event.deltaY > 0) zoomOut();

      // get offset between previous image point and origin
      const newRect = img.getBoundingClientRect();
      const offsetX = originX - (newRect.left + newRect.width * oldPercentX);
      const offsetY = originY - (newRect.top + newRect.height * oldPercentY);

      // translate image to keep image point under origin
      translateX += offsetX;
      translateY += offsetY;

      // perform translate
      updateTransform();
    };

    // when container is clicked
    function onContainerClick(event) {
      // if container itself is target of click, and not other
      // element above it
      if (event.target === this) closeLightbox();
    }

    // when mouse button is pressed on image
    const onImageMouseDown = function (event) {
      // store original mouse position relative to image
      clickMouseX = window.mouseX;
      clickMouseY = window.mouseY;
      clickTranslateX = translateX;
      clickTranslateY = translateY;
      event.stopPropagation();
      event.preventDefault();
    };

    // when mouse button is released anywhere in window
    const onWindowMouseUp = function (event) {
      // reset original mouse position
      clickMouseX = undefined;
      clickMouseY = undefined;
      clickTranslateX = undefined;
      clickTranslateY = undefined;

      // remove global listener if lightbox removed from document
      if (!document.body.contains(container))
        window.removeEventListener("mouseup", onWindowMouseUp);
    };

    // when mouse is moved anywhere in window
    const onWindowMouseMove = function (event) {
      if (
        clickMouseX === undefined ||
        clickMouseY === undefined ||
        clickTranslateX === undefined ||
        clickTranslateY === undefined
      )
        return;

      // offset image based on original and current mouse position
      translateX = clickTranslateX + window.mouseX - clickMouseX;
      translateY = clickTranslateY + window.mouseY - clickMouseY;
      updateTransform();
      event.preventDefault();

      // remove global listener if lightbox removed from document
      if (!document.body.contains(container))
        window.removeEventListener("mousemove", onWindowMouseMove);
    };

    // when window is resized
    const onWindowResize = function (event) {
      fit();

      // remove global listener if lightbox removed from document
      if (!document.body.contains(container))
        window.removeEventListener("resize", onWindowResize);
    };

    // attach the necessary event listeners
    img.addEventListener("dblclick", fit);
    img.addEventListener("mousedown", onImageMouseDown);
    container.addEventListener("wheel", onContainerWheel);
    container.addEventListener("mousedown", onContainerClick);
    container.addEventListener("touchstart", onContainerClick);
    window.addEventListener("mouseup", onWindowMouseUp);
    window.addEventListener("mousemove", onWindowMouseMove);
    window.addEventListener("resize", onWindowResize);

    // run fit() after lightbox atttached to document and <img> Loaded
    // so needed container and img dimensions available
    img.addEventListener("load", fit);

    return img;
  }

  // make caption
  function makeCaption(img) {
    const caption = document.createElement("div");
    caption.id = "lightbox_caption";
    const captionSource = img.nextElementSibling;
    if (captionSource.tagName.toLowerCase() === "figcaption") {
      const captionCopy = makeCopy(captionSource);
      caption.innerHTML = captionCopy.innerHTML;
    }

    caption.addEventListener("touchstart", function (event) {
      event.stopPropagation();
    });

    return caption;
  }

  // make carbon copy of html dom element
  function makeCopy(source) {
    const sourceCopy = source.cloneNode(true);

    // delete elements marked with ignore (eg anchor and jump buttons)
    const deleteFromCopy = sourceCopy.querySelectorAll('[data-ignore="true"]');
    for (const element of deleteFromCopy) element.remove();

    // delete certain element attributes
    const attributes = [
      "id",
      "data-collapsed",
      "data-selected",
      "data-highlighted",
      "data-glow",
    ];
    for (const attribute of attributes) {
      sourceCopy.removeAttribute(attribute);
      const elements = sourceCopy.querySelectorAll("[" + attribute + "]");
      for (const element of elements) element.removeAttribute(attribute);
    }

    return sourceCopy;
  }

  // make button to jump to previous image in document
  function makePrevButton(img) {
    const prevButton = document.createElement("button");
    prevButton.id = "lightbox_prev_button";
    prevButton.title = "Jump to the previous image in the document [←]";
    prevButton.classList.add("icon_button", "lightbox_button");
    prevButton.innerHTML = document.querySelector(".icon_caret_left").innerHTML;

    // attach click listeners to button
    prevButton.addEventListener("click", function () {
      getPrevImg(img).click();
    });

    return prevButton;
  }

  // make button to jump to next image in document
  function makeNextButton(img) {
    const nextButton = document.createElement("button");
    nextButton.id = "lightbox_next_button";
    nextButton.title = "Jump to the next image in the document [→]";
    nextButton.classList.add("icon_button", "lightbox_button");
    nextButton.innerHTML = document.querySelector(
      ".icon_caret_right"
    ).innerHTML;

    // attach click listeners to button
    nextButton.addEventListener("click", function () {
      getNextImg(img).click();
    });

    return nextButton;
  }

  // get previous image in document
  function getPrevImg(img) {
    const imgs = document.querySelectorAll(".lightbox_document_img");

    // find index of provided img
    let index;
    for (index = 0; index < imgs.length; index++) {
      if (imgs[index] === img) break;
    }

    // wrap index to other side if < 1
    if (index - 1 >= 0) index--;
    else index = imgs.length - 1;
    return imgs[index];
  }

  // get next image in document
  function getNextImg(img) {
    const imgs = document.querySelectorAll(".lightbox_document_img");

    // find index of provided img
    let index;
    for (index = 0; index < imgs.length; index++) {
      if (imgs[index] === img) break;
    }

    // wrap index to other side if > total
    if (index + 1 <= imgs.length - 1) index++;
    else index = 0;
    return imgs[index];
  }

  // close lightbox
  function closeLightbox() {
    focusBody();

    const lightbox = document.getElementById("lightbox_overlay");
    if (lightbox) lightbox.remove();
  }

  // make all elements behind lightbox non-focusable
  function blurBody(overlay) {
    const all = document.querySelectorAll("*");
    for (const element of all) element.tabIndex = -1;
    document.body.classList.add("body_no_scroll");
  }

  // make all elements focusable again
  function focusBody() {
    const all = document.querySelectorAll("*");
    for (const element of all) element.removeAttribute("tabIndex");
    document.body.classList.remove("body_no_scroll");
  }

  // start script when document is finished loading
  window.addEventListener("load", start);
</script>

<!-- caret left icon -->

<template class="icon_caret_left">
  <!-- modified from: https://fontawesome.com/icons/caret-left -->
  <svg width="16" height="16" viewBox="0 0 192 512">
    <path
      fill="currentColor"
      d="M192 127.338v257.324c0 17.818-21.543 26.741-34.142 14.142L29.196 270.142c-7.81-7.81-7.81-20.474 0-28.284l128.662-128.662c12.599-12.6 34.142-3.676 34.142 14.142z"
    ></path>
  </svg>
</template>

<!-- caret right icon -->

<template class="icon_caret_right">
  <!-- modified from: https://fontawesome.com/icons/caret-right -->
  <svg width="16" height="16" viewBox="0 0 192 512">
    <path
      fill="currentColor"
      d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"
    ></path>
  </svg>
</template>

<style>
  @media only screen {
    /* regular <img> in document when hovered */
    img.lightbox_document_img:hover {
      cursor: pointer;
    }

    .body_no_scroll {
      overflow: hidden !important;
    }

    /* screen overlay */
    #lightbox_overlay {
      display: flex;
      flex-direction: column;
      position: fixed;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.75);
      z-index: 3;
    }

    /* middle area containing lightbox image */
    #lightbox_image_container {
      flex-grow: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      position: relative;
      padding: 20px;
    }

    /* bottom area containing caption */
    #lightbox_bottom_container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100px;
      min-height: 100px;
      max-height: 100px;
      background: rgba(0, 0, 0, 0.5);
    }

    /* image number info text box */
    #lightbox_number_info {
      position: absolute;
      color: #ffffff;
      font-weight: 600;
      left: 2px;
      top: 0;
      z-index: 4;
    }

    /* zoom info text box */
    #lightbox_zoom_info {
      position: absolute;
      color: #ffffff;
      font-weight: 600;
      right: 2px;
      top: 0;
      z-index: 4;
    }

    /* copy of image caption */
    #lightbox_caption {
      box-sizing: border-box;
      display: inline-block;
      width: 100%;
      max-height: 100%;
      padding: 10px 0;
      text-align: center;
      overflow-y: auto;
      color: #ffffff;
    }

    /* navigation previous/next button */
    .lightbox_button {
      width: 100px;
      height: 100%;
      min-width: 100px;
      min-height: 100%;
      color: #ffffff;
    }

    /* navigation previous/next button when hovered */
    .lightbox_button:hover {
      background: none !important;
    }

    /* navigation button icon */
    .lightbox_button > svg {
      height: 25px;
    }

    /* figure auto-number */
    #lightbox_caption > span:first-of-type {
      font-weight: bold;
      margin-right: 5px;
    }

    /* lightbox image when hovered */
    #lightbox_img:hover {
      cursor: grab;
    }

    /* lightbox image when grabbed */
    #lightbox_img:active {
      cursor: grabbing;
    }
  }

  /* when on screen < 480px wide */
  @media only screen and (max-width: 480px) {
    /* make navigation buttons skinnier on small screens to make more room for caption text */
    .lightbox_button {
      width: 50px;
      min-width: 50px;
    }
  }

  /* always hide lightbox on print */
  @media only print {
    #lightbox_overlay {
      display: none;
    }
  }
</style>
<!-- 
  Link Highlight Plugin

  Makes it such that when a user hovers or focuses a link, other links that have
  the same target will be highlighted. It also makes it such that when clicking
  a link, the target of the link (eg reference, figure, table) is briefly
  highlighted.
-->

<script type="module">
  // whether to also highlight links that go to external urls
  const externalLinks = "false";
  // whether user must click off to unhighlight instead of just
  // un-hovering
  const clickUnhighlight = "false";
  // whether to also highlight links that are unique
  const highlightUnique = "true";

  // start script
  function start() {
    const links = getLinks();
    for (const link of links) {
      // attach mouse and focus listeners to link
      link.addEventListener("mouseenter", onLinkFocus);
      link.addEventListener("focus", onLinkFocus);
      link.addEventListener("mouseleave", onLinkUnhover);
    }

    // attach click and hash change listeners to window
    window.addEventListener("click", onClick);
    window.addEventListener("touchstart", onClick);
    window.addEventListener("hashchange", onHashChange);

    // run hash change on window load in case user has navigated
    // directly to hash
    onHashChange();
  }

  // when link is focused (tabbed to) or hovered
  function onLinkFocus() {
    highlight(this);
  }

  // when link is unhovered
  function onLinkUnhover() {
    if (clickUnhighlight !== "true") unhighlightAll();
  }

  // when the mouse is clicked anywhere in window
  function onClick(event) {
    unhighlightAll();
  }

  // when hash (eg manuscript.html#introduction) changes
  function onHashChange() {
    const target = getHashTarget();
    if (target) glowElement(target);
  }

  // start glow sequence on an element
  function glowElement(element) {
    const startGlow = function () {
      onGlowEnd();
      element.dataset.glow = "true";
      element.addEventListener("animationend", onGlowEnd);
    };
    const onGlowEnd = function () {
      element.removeAttribute("data-glow");
      element.removeEventListener("animationend", onGlowEnd);
    };
    startGlow();
  }

  // highlight link and all others with same target
  function highlight(link) {
    // force unhighlight all to start fresh
    unhighlightAll();

    // get links with same target
    if (!link) return;
    const sameLinks = getSameLinks(link);

    // if link unique and option is off, exit and don't highlight
    if (sameLinks.length <= 1 && highlightUnique !== "true") return;

    // highlight all same links, and "select" (special highlight) this
    // one
    for (const sameLink of sameLinks) {
      if (sameLink === link) sameLink.setAttribute("data-selected", "true");
      else sameLink.setAttribute("data-highlighted", "true");
    }
  }

  // unhighlight all links
  function unhighlightAll() {
    const links = getLinks();
    for (const link of links) {
      link.setAttribute("data-selected", "false");
      link.setAttribute("data-highlighted", "false");
    }
  }

  // get links with same target
  function getSameLinks(link) {
    const results = [];
    const links = getLinks();
    for (const otherLink of links) {
      if (otherLink.getAttribute("href") === link.getAttribute("href"))
        results.push(otherLink);
    }
    return results;
  }

  // get all links of types we wish to handle
  function getLinks() {
    let query = "a";
    if (externalLinks !== "true") query += '[href^="#"]';
    // exclude buttons, anchor links, toc links, etc
    query += ":not(.button):not(.icon_button):not(.anchor):not(.toc_link)";
    return document.querySelectorAll(query);
  }

  // start script when document is finished loading
  window.addEventListener("load", start);
</script>

<style>
  @media only screen {
    /* anything with data-highlighted attribute true */
    [data-highlighted="true"] {
      background: #ffeb3b;
    }

    /* anything with data-selected attribute true */
    [data-selected="true"] {
      background: #ff8a65 !important;
    }

    /* animation definition for glow */
    @keyframes highlight_glow {
      0% {
        background: none;
      }
      10% {
        background: #bbdefb;
      }
      100% {
        background: none;
      }
    }

    /* anything with data-glow attribute true */
    [data-glow="true"] {
      animation: highlight_glow 2s;
    }
  }
</style>
<!--
  Table of Contents Plugin

  Provides a "table of contents" (toc) panel on the side of the document that
  allows the user to conveniently navigate between sections of the document.
-->

<script type="module">
  // which types of elements to add links for, in "document.querySelector" format
  const typesQuery = "h1, h2, h3";
  // whether toc starts open. use 'true' or 'false', or 'auto' to
  // use 'true' behavior when screen wide enough and 'false' when not
  const startOpen = "false";
  // whether toc closes when clicking on toc link. use 'true' or
  // 'false', or 'auto' to use 'false' behavior when screen wide
  // enough and 'true' when not
  const clickClose = "auto";
  // if list item is more than this many characters, text will be
  // truncated
  const charLimit = "50";
  // whether or not to show bullets next to each toc item
  const bullets = "false";

  // start script
  function start() {
    // make toc panel and populate with entries (links to document
    // sections)
    const panel = makePanel();
    if (!panel) return;
    makeEntries(panel);
    // attach panel to document after making entries, so 'toc' heading
    // in panel isn't included in toc
    document.body.insertBefore(panel, document.body.firstChild);

    // initial panel state
    if (startOpen === "true" || (startOpen === "auto" && !isSmallScreen()))
      openPanel();
    else closePanel();

    // attach click, scroll, and hash change listeners to window
    window.addEventListener("click", onClick);
    window.addEventListener("scroll", onScroll);
    window.addEventListener("hashchange", onScroll);
    window.addEventListener("keyup", onKeyUp);
    onScroll();

    // add class to push document body down out of way of toc button
    document.body.classList.add("toc_body_nudge");
  }

  // determine if screen wide enough to fit toc panel
  function isSmallScreen() {
    // in default theme:
    // 816px = 8.5in = width of "page" (<body>) element
    // 260px = min width of toc panel (*2 for both sides of <body>)
    return window.innerWidth < 816 + 260 * 2;
  }

  // when mouse is clicked anywhere in window
  function onClick() {
    if (isSmallScreen()) closePanel();
  }

  // when window is scrolled or hash changed
  function onScroll() {
    highlightViewed();
  }

  // when key pressed
  function onKeyUp(event) {
    if (!event || !event.key) return;

    // close on esc
    if (event.key === "Escape") closePanel();
  }

  // find entry of currently viewed document section in toc and highlight
  function highlightViewed() {
    const firstId = getFirstInView(typesQuery);

    // get toc entries (links), unhighlight all, then highlight viewed
    const list = document.getElementById("toc_list");
    if (!firstId || !list) return;
    const links = list.querySelectorAll("a");
    for (const link of links) link.dataset.viewing = "false";
    const link = list.querySelector('a[href="#' + firstId + '"]');
    if (!link) return;
    link.dataset.viewing = "true";
  }

  // get first or previous toc listed element in top half of view
  function getFirstInView(query) {
    // get all elements matching query and with id
    const elements = document.querySelectorAll(query);
    const elementsWithIds = [];
    for (const element of elements) {
      if (element.id) elementsWithIds.push(element);
    }

    // get first or previous element in top half of view
    for (let i = 0; i < elementsWithIds.length; i++) {
      const element = elementsWithIds[i];
      const prevElement = elementsWithIds[Math.max(0, i - 1)];
      if (element.getBoundingClientRect().top >= 0) {
        if (element.getBoundingClientRect().top < window.innerHeight / 2)
          return element.id;
        else return prevElement.id;
      }
    }
  }

  // make panel
  function makePanel() {
    // create panel
    const panel = document.createElement("div");
    panel.id = "toc_panel";
    if (bullets === "true") panel.dataset.bullets = "true";

    // create header
    const header = document.createElement("div");
    header.id = "toc_header";

    // create toc button
    const button = document.createElement("button");
    button.id = "toc_button";
    button.innerHTML = document.querySelector(".icon_th_list").innerHTML;
    button.title = "Table of Contents";
    button.classList.add("icon_button");

    // create header text
    const text = document.createElement("h4");
    text.innerHTML = "Table of Contents";

    // create container for toc list
    const list = document.createElement("div");
    list.id = "toc_list";

    // attach click listeners
    panel.addEventListener("click", onPanelClick);
    header.addEventListener("click", onHeaderClick);
    button.addEventListener("click", onButtonClick);

    // attach elements
    header.appendChild(button);
    header.appendChild(text);
    panel.appendChild(header);
    panel.appendChild(list);

    return panel;
  }

  // create toc entries (links) to each element of the specified types
  function makeEntries(panel) {
    const elements = document.querySelectorAll(typesQuery);
    for (const element of elements) {
      // do not add link if element doesn't have assigned id
      if (!element.id) continue;

      // create link/list item
      const link = document.createElement("a");
      link.classList.add("toc_link");
      switch (element.tagName.toLowerCase()) {
        case "h1":
          link.dataset.level = "1";
          break;
        case "h2":
          link.dataset.level = "2";
          break;
        case "h3":
          link.dataset.level = "3";
          break;
        case "h4":
          link.dataset.level = "4";
          break;
      }
      link.title = element.innerText;
      let text = element.innerText;
      if (text.length > charLimit) text = text.slice(0, charLimit) + "...";
      link.innerHTML = text;
      link.href = "#" + element.id;
      link.addEventListener("click", onLinkClick);

      // attach link
      panel.querySelector("#toc_list").appendChild(link);
    }
  }

  // when panel is clicked
  function onPanelClick(event) {
    // stop click from propagating to window/document and closing panel
    event.stopPropagation();
  }

  // when header itself is clicked
  function onHeaderClick(event) {
    togglePanel();
  }

  // when button is clicked
  function onButtonClick(event) {
    togglePanel();
    // stop header underneath button from also being clicked
    event.stopPropagation();
  }

  // when link is clicked
  function onLinkClick(event) {
    if (clickClose === "true" || (clickClose === "auto" && isSmallScreen()))
      closePanel();
    else openPanel();
  }

  // open panel if closed, close if opened
  function togglePanel() {
    const panel = document.getElementById("toc_panel");
    if (!panel) return;

    if (panel.dataset.open === "true") closePanel();
    else openPanel();
  }

  // open panel
  function openPanel() {
    const panel = document.getElementById("toc_panel");
    if (panel) panel.dataset.open = "true";
  }

  // close panel
  function closePanel() {
    const panel = document.getElementById("toc_panel");
    if (panel) panel.dataset.open = "false";
  }

  // start script when document is finished loading
  window.addEventListener("load", start);
</script>

<!-- th list icon -->

<template class="icon_th_list">
  <!-- modified from: https://fontawesome.com/icons/th-list -->
  <svg width="16" height="16" viewBox="0 0 512 512" tabindex="-1">
    <path
      fill="currentColor"
      d="M96 96c0 26.51-21.49 48-48 48S0 122.51 0 96s21.49-48 48-48 48 21.49 48 48zM48 208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm0 160c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm96-236h352c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"
      tabindex="-1"
    ></path>
  </svg>
</template>

<style>
  @media only screen {
    /* toc panel */
    #toc_panel {
      box-sizing: border-box;
      position: fixed;
      top: 0;
      left: 0;
      background: #ffffff;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
      z-index: 2;
    }

    /* toc panel when closed */
    #toc_panel[data-open="false"] {
      min-width: 60px;
      width: 60px;
      height: 60px;
      border-right: solid 1px #bdbdbd;
      border-bottom: solid 1px #bdbdbd;
    }

    /* toc panel when open */
    #toc_panel[data-open="true"] {
      min-width: 260px;
      max-width: 480px;
      /* keep panel edge consistent distance away from "page" edge */
      width: calc(((100vw - 8.5in) / 2) - 30px - 40px);
      bottom: 0;
      border-right: solid 1px #bdbdbd;
    }

    /* toc panel header */
    #toc_header {
      box-sizing: border-box;
      display: flex;
      flex-direction: row;
      align-items: center;
      height: 60px;
      margin: 0;
      padding: 20px;
    }

    /* toc panel header when hovered */
    #toc_header:hover {
      cursor: pointer;
    }

    /* toc panel header when panel open */
    #toc_panel[data-open="true"] > #toc_header {
      border-bottom: solid 1px #bdbdbd;
    }

    /* toc open/close header button */
    #toc_button {
      margin-right: 20px;
    }

    /* hide toc list and header text when closed */
    #toc_panel[data-open="false"] > #toc_header > *:not(#toc_button),
    #toc_panel[data-open="false"] > #toc_list {
      display: none;
    }

    /* toc list of entries */
    #toc_list {
      box-sizing: border-box;
      width: 100%;
      padding: 20px;
      position: absolute;
      top: calc(60px + 1px);
      bottom: 0;
      overflow: auto;
    }

    /* toc entry, link to section in document */
    .toc_link {
      display: block;
      padding: 5px;
      position: relative;
      font-weight: 600;
      text-decoration: none;
    }

    /* toc entry when hovered or when "viewed" */
    .toc_link:hover,
    .toc_link[data-viewing="true"] {
      background: #f5f5f5;
    }

    /* toc entry, level 1 indentation */
    .toc_link[data-level="1"] {
      margin-left: 0;
    }

    /* toc entry, level 2 indentation */
    .toc_link[data-level="2"] {
      margin-left: 20px;
    }

    /* toc entry, level 3 indentation */
    .toc_link[data-level="3"] {
      margin-left: 40px;
    }

    /* toc entry, level 4 indentation */
    .toc_link[data-level="4"] {
      margin-left: 60px;
    }

    /* toc entry bullets */
    #toc_panel[data-bullets="true"] .toc_link[data-level]:before {
      position: absolute;
      left: -15px;
      top: -1px;
      font-size: 1.5em;
    }

    /* toc entry, level 2 bullet */
    #toc_panel[data-bullets="true"] .toc_link[data-level="2"]:before {
      content: "\2022";
    }

    /* toc entry, level 3 bullet */
    #toc_panel[data-bullets="true"] .toc_link[data-level="3"]:before {
      content: "\25AB";
    }

    /* toc entry, level 4 bullet */
    #toc_panel[data-bullets="true"] .toc_link[data-level="4"]:before {
      content: "-";
    }
  }

  /* when on screen < 8.5in wide */
  @media only screen and (max-width: 8.5in) {
    /* push <body> ("page") element down to make room for toc icon */
    .toc_body_nudge {
      padding-top: 60px;
    }

    /* toc icon when panel closed and not hovered */
    #toc_panel[data-open="false"]:not(:hover) {
      background: rgba(255, 255, 255, 0.75);
    }
  }

  /* always hide toc panel on print */
  @media only print {
    #toc_panel {
      display: none;
    }
  }
</style>
<!-- 
  Tooltips Plugin

  Makes it such that when the user hovers or focuses a link to a citation or
  figure, a tooltip appears with a preview of the reference content, along with
  arrows to navigate between instances of the same reference in the document.
-->

<script type="module">
  // whether user must click off to close tooltip instead of just un-hovering
  const clickClose = "false";
  // delay (in ms) between opening and closing tooltip
  const delay = "100";

  // start script
  function start() {
    const links = getLinks();
    for (const link of links) {
      // attach hover and focus listeners to link
      link.addEventListener("mouseover", onLinkHover);
      link.addEventListener("mouseleave", onLinkUnhover);
      link.addEventListener("focus", onLinkFocus);
      link.addEventListener("touchend", onLinkTouch);
    }

    // attach mouse, key, and resize listeners to window
    window.addEventListener("mousedown", onClick);
    window.addEventListener("touchstart", onClick);
    window.addEventListener("keyup", onKeyUp);
    window.addEventListener("resize", onResize);
  }

  // when link is hovered
  function onLinkHover() {
    // function to open tooltip
    const delayOpenTooltip = function () {
      openTooltip(this);
    }.bind(this);

    // run open function after delay
    this.openTooltipTimer = window.setTimeout(delayOpenTooltip, delay);
  }

  // when mouse leaves link
  function onLinkUnhover() {
    // cancel opening tooltip
    window.clearTimeout(this.openTooltipTimer);

    // don't close on unhover if option specifies
    if (clickClose === "true") return;

    // function to close tooltip
    const delayCloseTooltip = function () {
      // if tooltip open and if mouse isn't over tooltip, close
      const tooltip = document.getElementById("tooltip");
      if (tooltip && !tooltip.matches(":hover")) closeTooltip();
    };

    // run close function after delay
    this.closeTooltipTimer = window.setTimeout(delayCloseTooltip, delay);
  }

  // when link is focused (tabbed to)
  function onLinkFocus(event) {
    openTooltip(this);
  }

  // when link is touched on touch screen
  function onLinkTouch(event) {
    // attempt to force hover state on first tap always, and trigger
    // regular link click (and navigation) on second tap
    if (event.target === document.activeElement) event.target.click();
    else {
      document.activeElement.blur();
      event.target.focus();
    }
    if (event.cancelable) event.preventDefault();
    event.stopPropagation();
    return false;
  }

  // when mouse is clicked anywhere in window
  function onClick(event) {
    closeTooltip();
  }

  // when key pressed
  function onKeyUp(event) {
    if (!event || !event.key) return;

    switch (event.key) {
      // trigger click of prev button
      case "ArrowLeft":
        const prevButton = document.getElementById("tooltip_prev_button");
        if (prevButton) prevButton.click();
        break;
      // trigger click of next button
      case "ArrowRight":
        const nextButton = document.getElementById("tooltip_next_button");
        if (nextButton) nextButton.click();
        break;
      // close on esc
      case "Escape":
        closeTooltip();
        break;
    }
  }

  // when window is resized or zoomed
  function onResize() {
    closeTooltip();
  }

  // get all links of types we wish to handle
  function getLinks() {
    const queries = [];
    // exclude buttons, anchor links, toc links, etc
    const exclude =
      ":not(.button):not(.icon_button):not(.anchor):not(.toc_link)";
    queries.push('a[href^="#ref-"]' + exclude); // citation links
    queries.push('a[href^="#fig:"]' + exclude); // figure links
    const query = queries.join(", ");
    return document.querySelectorAll(query);
  }

  // get links with same target, get index of link in set, get total
  // same links
  function getSameLinks(link) {
    const sameLinks = [];
    const links = getLinks();
    for (const otherLink of links) {
      if (otherLink.getAttribute("href") === link.getAttribute("href"))
        sameLinks.push(otherLink);
    }

    return {
      elements: sameLinks,
      index: sameLinks.indexOf(link),
      total: sameLinks.length,
    };
  }

  // open tooltip
  function openTooltip(link) {
    // delete tooltip if it exists, start fresh
    closeTooltip();

    // make tooltip element
    const tooltip = makeTooltip(link);

    // if source couldn't be found and tooltip not made, exit
    if (!tooltip) return;

    // make navbar elements
    const navBar = makeNavBar(link);
    if (navBar) tooltip.firstElementChild.appendChild(navBar);

    // attach tooltip to page
    document.body.appendChild(tooltip);

    // position tooltip
    const position = function () {
      positionTooltip(link);
    };
    position();

    // if tooltip contains images, position again after they've loaded
    const imgs = tooltip.querySelectorAll("img");
    for (const img of imgs) img.addEventListener("load", position);
  }

  // close (delete) tooltip
  function closeTooltip() {
    const tooltip = document.getElementById("tooltip");
    if (tooltip) tooltip.remove();
  }

  // make tooltip
  function makeTooltip(link) {
    // get target element that link points to
    const source = getSource(link);

    // if source can't be found, exit
    if (!source) return;

    // create new tooltip
    const tooltip = document.createElement("div");
    tooltip.id = "tooltip";
    const tooltipContent = document.createElement("div");
    tooltipContent.id = "tooltip_content";
    tooltip.appendChild(tooltipContent);

    // make copy of source node and put in tooltip
    const sourceCopy = makeCopy(source);
    tooltipContent.appendChild(sourceCopy);

    // attach mouse event listeners
    tooltip.addEventListener("click", onTooltipClick);
    tooltip.addEventListener("mousedown", onTooltipClick);
    tooltip.addEventListener("touchstart", onTooltipClick);
    tooltip.addEventListener("mouseleave", onTooltipUnhover);

    // (for interaction with lightbox plugin)
    // transfer click on tooltip copied img to original img
    const sourceImg = source.querySelector("img");
    const sourceCopyImg = sourceCopy.querySelector("img");
    if (sourceImg && sourceCopyImg) {
      const clickImg = function () {
        sourceImg.click();
        closeTooltip();
      };
      sourceCopyImg.addEventListener("click", clickImg);
    }

    return tooltip;
  }

  // make carbon copy of html dom element
  function makeCopy(source) {
    const sourceCopy = source.cloneNode(true);

    // delete elements marked with ignore (eg anchor and jump buttons)
    const deleteFromCopy = sourceCopy.querySelectorAll('[data-ignore="true"]');
    for (const element of deleteFromCopy) element.remove();

    // delete certain element attributes
    const attributes = [
      "id",
      "data-collapsed",
      "data-selected",
      "data-highlighted",
      "data-glow",
      "class",
    ];
    for (const attribute of attributes) {
      sourceCopy.removeAttribute(attribute);
      const elements = sourceCopy.querySelectorAll("[" + attribute + "]");
      for (const element of elements) element.removeAttribute(attribute);
    }

    return sourceCopy;
  }

  // when tooltip is clicked
  function onTooltipClick(event) {
    // when user clicks on tooltip, stop click from transferring
    // outside of tooltip (eg, click off to close tooltip, or eg click
    // off to unhighlight same refs)
    event.stopPropagation();
  }

  // when tooltip is unhovered
  function onTooltipUnhover(event) {
    if (clickClose === "true") return;

    // make sure new mouse/touch/focus no longer over tooltip or any
    // element within it
    const tooltip = document.getElementById("tooltip");
    if (!tooltip) return;
    if (this.contains(event.relatedTarget)) return;

    closeTooltip();
  }

  // make nav bar to go betwen prev/next instances of same reference
  function makeNavBar(link) {
    // find other links to the same source
    const sameLinks = getSameLinks(link);

    // don't show nav bar when singular reference
    if (sameLinks.total <= 1) return;

    // find prev/next links with same target
    const prevLink = getPrevLink(link, sameLinks);
    const nextLink = getNextLink(link, sameLinks);

    // create nav bar
    const navBar = document.createElement("div");
    navBar.id = "tooltip_nav_bar";
    const text = sameLinks.index + 1 + " of " + sameLinks.total;

    // create nav bar prev/next buttons
    const prevButton = document.createElement("button");
    const nextButton = document.createElement("button");
    prevButton.id = "tooltip_prev_button";
    nextButton.id = "tooltip_next_button";
    prevButton.title =
      "Jump to the previous occurence of this item in the document [←]";
    nextButton.title =
      "Jump to the next occurence of this item in the document [→]";
    prevButton.classList.add("icon_button");
    nextButton.classList.add("icon_button");
    prevButton.innerHTML = document.querySelector(".icon_caret_left").innerHTML;
    nextButton.innerHTML =
      document.querySelector(".icon_caret_right").innerHTML;
    navBar.appendChild(prevButton);
    navBar.appendChild(document.createTextNode(text));
    navBar.appendChild(nextButton);

    // attach click listeners to buttons
    prevButton.addEventListener("click", function () {
      onPrevNextClick(link, prevLink);
    });
    nextButton.addEventListener("click", function () {
      onPrevNextClick(link, nextLink);
    });

    return navBar;
  }

  // get previous link with same target
  function getPrevLink(link, sameLinks) {
    if (!sameLinks) sameLinks = getSameLinks(link);
    // wrap index to other side if < 1
    let index;
    if (sameLinks.index - 1 >= 0) index = sameLinks.index - 1;
    else index = sameLinks.total - 1;
    return sameLinks.elements[index];
  }

  // get next link with same target
  function getNextLink(link, sameLinks) {
    if (!sameLinks) sameLinks = getSameLinks(link);
    // wrap index to other side if > total
    let index;
    if (sameLinks.index + 1 <= sameLinks.total - 1) index = sameLinks.index + 1;
    else index = 0;
    return sameLinks.elements[index];
  }

  // get element that is target of link or url hash
  function getSource(link) {
    const hash = link ? link.hash : window.location.hash;
    const id = hash.slice(1);
    let target = document.querySelector('[id="' + id + '"]');
    if (!target) return;

    // if ref or figure, modify target to get expected element
    if (id.indexOf("ref-") === 0) target = target.querySelector(":nth-child(2)");
    else if (id.indexOf("fig:") === 0) target = target.querySelector("figure");

    return target;
  }

  // when prev/next arrow button is clicked
  function onPrevNextClick(link, prevNextLink) {
    if (link && prevNextLink)
      goToElement(prevNextLink, window.innerHeight * 0.5);
  }

  // scroll to and focus element
  function goToElement(element, offset) {
    // expand accordion section if collapsed
    expandElement(element);
    const y =
      getRectInView(element).top -
      getRectInView(document.documentElement).top -
      (offset || 0);
    // trigger any function listening for "onscroll" event
    window.dispatchEvent(new Event("scroll"));
    window.scrollTo(0, y);
    document.activeElement.blur();
    element.focus();
  }

  // determine position to place tooltip based on link position in
  // viewport and tooltip size
  function positionTooltip(link, left, top) {
    const tooltipElement = document.getElementById("tooltip");
    if (!tooltipElement) return;

    // get convenient vars for position/dimensions of
    // link/tooltip/page/view
    link = getRectInPage(link);
    const tooltip = getRectInPage(tooltipElement);
    const view = getRectInPage();

    // horizontal positioning
    if (left)
      // use explicit value
      left = left;
    else if (link.left + tooltip.width < view.right)
      // fit tooltip to right of link
      left = link.left;
    else if (link.right - tooltip.width > view.left)
      // fit tooltip to left of link
      left = link.right - tooltip.width;
    // center tooltip in view
    else left = (view.right - view.left) / 2 - tooltip.width / 2;

    // vertical positioning
    if (top)
      // use explicit value
      top = top;
    else if (link.top - tooltip.height > view.top)
      // fit tooltip above link
      top = link.top - tooltip.height;
    else if (link.bottom + tooltip.height < view.bottom)
      // fit tooltip below link
      top = link.bottom;
    else {
      // center tooltip in view
      top = view.top + view.height / 2 - tooltip.height / 2;
      // nudge off of link to left/right if possible
      if (link.right + tooltip.width < view.right) left = link.right;
      else if (link.left - tooltip.width > view.left)
        left = link.left - tooltip.width;
    }

    tooltipElement.style.left = left + "px";
    tooltipElement.style.top = top + "px";
  }

  // start script when document is finished loading
  window.addEventListener("load", start);
</script>

<!-- caret left icon -->

<template class="icon_caret_left">
  <!-- modified from: https://fontawesome.com/icons/caret-left -->
  <svg width="16" height="16" viewBox="0 0 192 512">
    <path
      fill="currentColor"
      d="M192 127.338v257.324c0 17.818-21.543 26.741-34.142 14.142L29.196 270.142c-7.81-7.81-7.81-20.474 0-28.284l128.662-128.662c12.599-12.6 34.142-3.676 34.142 14.142z"
    ></path>
  </svg>
</template>

<!-- caret right icon -->

<template class="icon_caret_right">
  <!-- modified from: https://fontawesome.com/icons/caret-right -->
  <svg width="16" height="16" viewBox="0 0 192 512">
    <path
      fill="currentColor"
      d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"
    ></path>
  </svg>
</template>

<style>
  @media only screen {
    /* tooltip container */
    #tooltip {
      position: absolute;
      width: 50%;
      min-width: 240px;
      max-width: 75%;
      z-index: 1;
    }

    /* tooltip content */
    #tooltip_content {
      margin-bottom: 5px;
      padding: 20px;
      border-radius: 5px;
      border: solid 1px #bdbdbd;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
      background: #ffffff;
      overflow-wrap: break-word;
    }

    /* tooltip copy of paragraphs and figures */
    #tooltip_content > p,
    #tooltip_content > figure {
      margin: 0;
      max-height: 320px;
      overflow-y: auto;
    }

    /* tooltip copy of <img> */
    #tooltip_content > figure > img,
    #tooltip_content > figure > svg {
      max-height: 260px;
    }

    /* navigation bar */
    #tooltip_nav_bar {
      margin-top: 10px;
      text-align: center;
    }

    /* navigation bar previous/next buton */
    #tooltip_nav_bar > .icon_button {
      position: relative;
      top: 3px;
    }

    /* navigation bar previous button */
    #tooltip_nav_bar > .icon_button:first-of-type {
      margin-right: 5px;
    }

    /* navigation bar next button */
    #tooltip_nav_bar > .icon_button:last-of-type {
      margin-left: 5px;
    }
  }

  /* always hide tooltip on print */
  @media only print {
    #tooltip {
      display: none;
    }
  }
</style>
<!--
  Analytics Plugin (third-party) 
  
  Copy and paste code from Google Analytics or similar service here.
-->
<!-- 
  Annotations Plugin

  Allows public annotation of the  manuscript. See https://web.hypothes.is/.
-->

<script type="module">
  // configuration
  window.hypothesisConfig = function () {
    return {
      branding: {
        accentColor: "#2196f3",
        appBackgroundColor: "#f8f8f8",
        ctaBackgroundColor: "#f8f8f8",
        ctaTextColor: "#000000",
        selectionFontFamily: "Open Sans, Helvetica, sans serif",
        annotationFontFamily: "Open Sans, Helvetica, sans serif",
      },
    };
  };

  // hypothesis client script
  const embed = "https://hypothes.is/embed.js";
  // hypothesis annotation count query url
  const query = "https://api.hypothes.is/api/search?limit=0&url=";

  // start script
  function start() {
    const button = makeButton();
    document.body.insertBefore(button, document.body.firstChild);
    insertCount(button);
  }

  // make button
  function makeButton() {
    // create button
    const button = document.createElement("button");
    button.id = "hypothesis_button";
    button.innerHTML = document.querySelector(".icon_hypothesis").innerHTML;
    button.title = "Hypothesis annotations";
    button.classList.add("icon_button");

    function onClick(event) {
      onButtonClick(event, button);
    }

    // attach click listeners
    button.addEventListener("click", onClick);

    return button;
  }

  // insert annotations count
  async function insertCount(button) {
    // get annotation count from Hypothesis based on url
    let count = "-";
    try {
      const canonical = document.querySelector('link[rel="canonical"]');
      const location = window.location;
      const url = encodeURIComponent((canonical || location).href);
      const response = await fetch(query + url);
      const json = await response.json();
      count = json.total || "-";
    } catch (error) {
      console.log(error);
    }

    // put count into button
    const counter = document.createElement("span");
    counter.id = "hypothesis_count";
    counter.innerHTML = count;
    button.title = "View " + count + " Hypothesis annotations";
    button.append(counter);
  }

  // when button is clicked
  function onButtonClick(event, button) {
    const script = document.createElement("script");
    script.src = embed;
    document.body.append(script);
    button.remove();
  }

  // start script when document is finished loading
  window.addEventListener("load", start);
</script>

<!-- hypothesis icon -->

<template class="icon_hypothesis">
  <!-- modified from: https://simpleicons.org/icons/hypothesis.svg / https://git.io/Jf1VB -->
  <svg width="16" height="16" viewBox="0 0 24 24" tabindex="-1">
    <path
      fill="currentColor"
      d="M3.43 0C2.5 0 1.72 .768 1.72 1.72V18.86C1.72 19.8 2.5 20.57 3.43 20.57H9.38L12 24L14.62 20.57H20.57C21.5 20.57 22.29 19.8 22.29 18.86V1.72C22.29 .77 21.5 0 20.57 0H3.43M5.14 3.43H7.72V9.43S8.58 7.72 10.28 7.72C12 7.72 13.74 8.57 13.74 11.24V17.14H11.16V12C11.16 10.61 10.28 10.07 9.43 10.29C8.57 10.5 7.72 11.41 7.72 13.29V17.14H5.14V3.43M18 13.72C18.95 13.72 19.72 14.5 19.72 15.42A1.71 1.71 0 0 1 18 17.13A1.71 1.71 0 0 1 16.29 15.42C16.29 14.5 17.05 13.71 18 13.71Z"
      tabindex="-1"
    ></path>
  </svg>
</template>

<style>
  /* hypothesis activation button */
  #hypothesis_button {
    box-sizing: border-box;
    position: fixed;
    top: 0;
    right: 0;
    width: 60px;
    height: 60px;
    background: #ffffff;
    border-radius: 0;
    border-left: solid 1px #bdbdbd;
    border-bottom: solid 1px #bdbdbd;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
    z-index: 2;
  }

  /* hypothesis button svg */
  #hypothesis_button > svg {
    position: relative;
    top: -4px;
  }

  /* hypothesis annotation count */
  #hypothesis_count {
    position: absolute;
    left: 0;
    right: 0;
    bottom: 5px;
  }

  /* side panel */
  .annotator-frame {
    width: 280px !important;
  }

  /* match highlight color to rest of theme */
  .annotator-highlights-always-on .annotator-hl {
    background-color: #ffeb3b !important;
  }

  /* match focused color to rest of theme */
  .annotator-hl.annotator-hl-focused {
    background-color: #ff8a65 !important;
  }

  /* match bucket bar color to rest of theme */
  .annotator-bucket-bar {
    background: #f5f5f5 !important;
  }

  /* always hide button, toolbar, and tooltip on print */
  @media only print {
    #hypothesis_button {
      display: none;
    }

    .annotator-frame {
      display: none !important;
    }

    hypothesis-adder {
      display: none !important;
    }
  }
</style>
<!-- 
  Mathjax Plugin (third-party) 

  Allows the proper rendering of math/equations written in LaTeX.
  See https://www.mathjax.org/.
-->

<script type="text/x-mathjax-config">
  // configuration
  MathJax.Hub.Config({
    "CommonHTML": { linebreaks: { automatic: true } },
    "HTML-CSS": { linebreaks: { automatic: true } },
    "SVG": { linebreaks: { automatic: true } },
    "fast-preview": { disabled: true }
  });
</script>

<script
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"
  integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A=="
  crossorigin="anonymous"
></script>

<style>
  /* mathjax containers */
  .math.display > span:not(.MathJax_Preview) {
    /* turn inline element (no dimensions) into block (allows fixed width and thus scrolling) */
    display: flex !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    justify-content: center;
    align-items: center;
    margin: 0 !important;
  }

  /* right click menu */
  .MathJax_Menu {
    border-radius: 5px !important;
    border: solid 1px #bdbdbd !important;
    box-shadow: none !important;
  }

  /* equation auto-number */
  span[id^="eq:"] > span.math.display + span {
    font-weight: 600;
  }

  /* equation */
  span[id^="eq:"] > span.math.display > span {
    /* nudge to make room for equation auto-number and anchor */
    margin-right: 60px !important;
  }
</style>
</body>
</html>
